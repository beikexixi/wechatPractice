webpackJsonp([3],{"+Te1":function(t,e,a){"use strict";var r={props:["versionInfo"],data:()=>({}),methods:{disVisDialog(){this.$emit("disVisDialogz")}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"autoStepAdd",attrs:{model:t.versionInfo,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"主工程名称"}},[a("span",[t._v(t._s(t.versionInfo.name))])]),a("el-form-item",{attrs:{label:"版本"}},[a("span",[t._v(t._s(t.versionInfo.version))])]),a("el-form-item",{attrs:{label:"PodFile"}},[a("el-col",{attrs:{span:20}},[a("el-input",{attrs:{type:"textarea",rows:"10"},model:{value:t.versionInfo.podfile,callback:function(e){t.$set(t.versionInfo,"podfile",e)},expression:"versionInfo.podfile"}})],1)],1),a("el-form-item",[a("el-button",{staticClass:"disButton",attrs:{type:"primary",size:"small"},on:{click:t.disVisDialog}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var i=a("VU/8")(r,s,!1,function(t){a("vxKL")},"data-v-dfdcd152",null).exports,o={props:["versionInfo"],data:()=>({}),methods:{disVisDialog(){this.$emit("disVisDialogs")}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"autoStepAdd",attrs:{model:t.versionInfo,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"主工程名称"}},[a("span",[t._v(t._s(t.versionInfo.name))])]),a("el-form-item",{attrs:{label:"版本"}},[a("span",[t._v(t._s(t.versionInfo.version))])]),a("el-form-item",{attrs:{label:"下载二维码"}},[a("img",{staticStyle:{width:"200px"},attrs:{src:t.versionInfo.img_src}})]),a("el-form-item",{attrs:{label:"下载链接"}},[a("a",{staticClass:"downUrlStyle",attrs:{href:t.versionInfo.downUrl,target:"_blank"}},[t._v(" "+t._s(t.versionInfo.downUrl))])]),a("el-form-item",[a("el-button",{staticClass:"disButton",attrs:{type:"primary"},on:{click:t.disVisDialog}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var l=a("VU/8")(o,n,!1,function(t){a("VjMH")},"data-v-6f178a07",null).exports,d=a("71e1"),u=a.n(d),c={props:["tableData"],data:()=>({versionInfo:{},dialogVisibleLoading:!1,dialogVisibleInfo:!1,dialogVisibleInfoDownUrl:!1}),components:{clientAssemInfo:i,clientAssemblerdown:l},methods:{openAutoTestInfo(t,e,a){console.log(222),this.dialogVisibleInfo=!0,this.dialogVisibleInfoDownUrl=!1,this.versionInfo={name:t,version:e,podfile:a}},disVisDialogz(){this.dialogVisibleInfo=!1},disVisDialogs(){this.dialogVisibleInfoDownUrl=!1},openAutoTestDownUrl(t,e,a){this.dialogVisibleInfo=!1,this.dialogVisibleInfoDownUrl=!0,this.versionInfo={name:t,version:e,downUrl:a};let r=this;u.a.toDataURL(a,{errorCorrectionLevel:"H"},function(t,e){r.versionInfo.img_src=e})}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"stripe","max-height":"250"}},[a("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"50px"}}),a("el-table-column",{attrs:{label:"版本号(tag)",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{staticClass:"tagStyle",attrs:{type:"success"},nativeOn:{click:function(a){t.openAutoTestInfo(e.row.name,e.row.version,e.row.podfile)}}},[t._v(t._s(e.row.version))])]}}])}),a("el-table-column",{attrs:{prop:"commitid",label:"commit id","min-width":"50px"}}),a("el-table-column",{attrs:{prop:"date",label:"打包时间","min-width":"50px"}}),a("el-table-column",{attrs:{prop:"operator",label:"打包人","min-width":"50px"}}),a("el-table-column",{attrs:{label:"打包状态",width:"145px"},scopedSlots:t._u([{key:"default",fn:function(e){return["WORKING"===e.row.status?a("el-tag",{staticClass:"smallBtn",attrs:{type:"success"}},[t._v("装配/编译中")]):"CANCELLED"===e.row.status?a("el-tag",{staticClass:"tagStyle",attrs:{type:"warning"}},[t._v("取消装配-del")]):"PENDING"===e.row.status?a("el-tag",{staticClass:"tagStyle",attrs:{type:"warning"}},[t._v("排队队列中-del")]):"FAILURE"===e.row.status?a("el-tag",{staticClass:"tagStyle",attrs:{type:"danger"}},[t._v(" 装配失败")]):"PASSED"===e.row.status?a("el-tag",{staticClass:"tagStyle",attrs:{type:"success"}},[t._v(" 装配成功")]):"COMPLETE"===e.row.status?a("el-tag",{staticClass:"tagStyle",attrs:{type:"danger"}},[t._v(" 上传成功")]):a("el-tag",{staticClass:"tagStyle",attrs:{type:"info"}},[t._v(t._s(e.row.status))])]}}])}),a("el-table-column",{attrs:{prop:"startTime",label:"下载","min-width":"50px"},scopedSlots:t._u([{key:"default",fn:function(e){return["PASSED"===e.row.status?a("el-button",{staticClass:"smallBtn",attrs:{type:"info"},on:{click:function(a){t.openAutoTestDownUrl(e.row.name,e.row.version,e.row.downUrl)}}},[a("i",{staticClass:"el-icon-download"})]):t._e()]}}])})],1),a("el-dialog",{attrs:{title:"APP打包信息",visible:t.dialogVisibleInfo,width:"60%"},on:{"update:visible":function(e){t.dialogVisibleInfo=e}}},[a("clientAssemInfo",{attrs:{versionInfo:t.versionInfo},on:{disVisDialogz:t.disVisDialogz}})],1),a("el-dialog",{attrs:{title:"APP下载",visible:t.dialogVisibleInfoDownUrl,width:"55%"},on:{"update:visible":function(e){t.dialogVisibleInfoDownUrl=e}}},[a("clientAssemblerdown",{attrs:{versionInfo:t.versionInfo},on:{disVisDialogs:t.disVisDialogs}})],1)],1)},staticRenderFns:[]};var h=a("VU/8")(c,p,!1,function(t){a("Ub4f")},null,null);e.a=h.exports},"+YqC":function(t,e){},"09xr":function(t,e,a){"use strict";var r=a("NZZJ"),s={props:["jiraKey","report"],data(){return{data:{jiraKey:this.jiraKey,type:"StandardTestApply",sendUserMail:"",sendUserName:"",emailTo:[],summary:"",env:null,gitInfo:[],subTasks:[],bugList:[],testSuggest:"",uploadFiles:"",isSubmitAll:!1}}},watch:{report:{handler:function(){this.data={jiraKey:this.jiraKey,type:"StandardTestApply",sendUserMail:"",sendUserName:"",emailTo:[],summary:"",env:null,gitInfo:[],subTasks:[],bugList:[],testSuggest:"",uploadFiles:"",isSubmitAll:!1},this.data=this.report},deep:!0}},mounted(){this.data=this.report},methods:{cancle(){this.$emit("closeDialog")}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return""!=t.report?a("el-form",{staticStyle:{width:"90%"},attrs:{"label-width":"120px"}},[a("el-form-item",{attrs:{label:"收件人"}},[a("el-input",{attrs:{disabled:!0,placeholder:t.data.emailTo}})],1),a("el-form-item",{attrs:{label:"项目名称"}},[a("a",{attrs:{href:"http://jira.vipkid.com.cn/browse/"+t.data.jiraKey,target:"view_window"}},[t._v(t._s(t.data.summary))])]),a("el-form-item",{attrs:{label:"指定测试环境"}},[a("el-row",[a("el-tag",{attrs:{type:"info"}},[t._v(t._s(t.data.env))])],1),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.data.gitInfo}},[a("el-table-column",{attrs:{label:"本次提测",fixed:"fixed",width:"100px;"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{disabled:!0,checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"path",label:"仓库"}}),a("el-table-column",{attrs:{prop:"branch",label:"分支"}}),a("el-table-column",{attrs:{prop:"SHA",label:"本次提测SHA"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.SHA.substring(0,8)))])]}}])}),a("el-table-column",{attrs:{prop:"preSHA",label:"上次提测SHA"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.preSHA&&""!==e.row.preSHA?a("div",[t._v(t._s(e.row.preSHA.substring(0,8)))]):a("div",[t._v("---")])]}}])}),a("el-table-column",{attrs:{label:"与上次提测SHA的差异"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.preSHA&&""!==e.row.preSHA&&e.row.preSHA!==e.row.SHA?a("a",{attrs:{href:"https://code.vipkid.com.cn/"+e.row.path+"/compare/"+e.row.preSHA+"..."+e.row.SHA,target:"view_window"}},[t._v(" 查看详情")]):t._e(),void 0===e.row.preSHA?a("div",[t._v("---")]):t._e(),e.row.preSHA==e.row.SHA?a("div",[t._v(" 代码无变化")]):t._e(),""==e.row.preSHA?a("div",[t._v("第一次提测")]):t._e()]}}])})],1)],1)],1),t.data.subTasks.length?a("el-form-item",{attrs:{label:"提测子任务"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.data.subTasks}},[a("el-table-column",{attrs:{label:"本次提测",width:"100px;"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{disabled:!0,checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID",width:"100px;"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}})],1)],1):t._e(),t.data.bugList.length?a("el-form-item",{attrs:{label:"提测待验BUG"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.data.bugList}},[a("el-table-column",{attrs:{label:"本次提测",fixed:"fixed",width:"100px;"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{disabled:!0,checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID",width:"100px;"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}})],1)],1):t._e(),a("el-form-item",{attrs:{label:"压力测试评估"}},[a("el-table",{attrs:{data:t.data.press,border:"border","show-header":!1}},[a("el-table-column",{attrs:{width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.descrip))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.$index?a("el-form",{ref:"form1",staticClass:"demo-ruleForm",attrs:{model:e.row}},[a("el-form-item",{attrs:{prop:"status"}},[a("el-radio-group",{attrs:{disabled:"disabled"},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}},[a("el-radio",{attrs:{label:e.row.label1}}),a("el-radio",{attrs:{label:e.row.label2}})],1)],1)],1):t._e(),1==e.$index&&"否"==t.data.press[0].status?a("el-form",{ref:"form2",staticClass:"demo-ruleForm",attrs:{model:e.row}},[a("el-form-item",{attrs:{prop:"reasonArr"}},[a("el-checkbox-group",{attrs:{disabled:"disabled"},model:{value:e.row.reasonArr,callback:function(a){t.$set(e.row,"reasonArr",a)},expression:"scope.row.reasonArr"}},[a("el-row",[a("el-checkbox",{attrs:{label:e.row.label1}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label2}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label3}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label4}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label5}})],1)],1)],1)],1):t._e(),1==e.$index&&"是"==t.data.press[0].status?a("el-form",{ref:"form3",staticClass:"demo-ruleForm",attrs:{model:e.row}},[a("el-form-item",{attrs:{prop:"reason"}},[a("el-input",{attrs:{disabled:"disabled"},model:{value:e.row.reason,callback:function(a){t.$set(e.row,"reason",a)},expression:"scope.row.reason"}})],1)],1):t._e()]}}])})],1)],1),a("el-form-item",{attrs:{label:"测试建议"}},[a("el-input",{attrs:{disabled:!0,type:"textarea",placeholder:"请输入内容"},model:{value:t.data.testSuggest,callback:function(e){t.$set(t.data,"testSuggest",e)},expression:"data.testSuggest"}})],1),a("el-form-item",{attrs:{label:"附件"}},t._l(t.data.uploadFiles,function(e,r){return a("p",{key:r},[a("a",{attrs:{href:e.url,target:"view_window"}},[t._v(t._s(e.name))])])})),a("el-form-item",{attrs:{align:"center"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.cancle}},[t._v("关闭")])],1)],1):t._e()},staticRenderFns:[]};var o=a("VU/8")(s,i,!1,function(t){a("PnjJ")},"data-v-218604e3",null).exports,n=a("uMhb");const l=a("NMds"),d=a("BAz6"),u=a("7OuW"),c=a("PJh5"),p=[{descrip:"是否执行压测",label1:"是",label2:"否",status:null}],h={descrip:"无需压测的原因",label1:"评估后不影响服务器性能",label2:"评估后性能影响有限",label3:"评估后不具备性能测试条件",label4:"评估后影响第三方服务",label5:"其他原因",reasonArr:[]},f={descrip:"压测目的及需求描述",reason:null};var m={props:["jiraKey","report"],components:{l_getEmail:r.a,l_uploadFile:n.a},computed:{getPress(){return"是"==this.data.press[0].status?(this.data.press.length>1&&this.data.press.pop(),this.data.press.push(this.pressReason)):"否"==this.data.press[0].status&&(this.data.press.length>1&&this.data.press.pop(),this.data.press.push(this.pressReasonArr)),this.data.press}},data(){return{data:{jiraStep:null,jiraKey:this.jiraKey,type:"StandardTestApply",sendUserMail:"",sendUserName:"",emailTo:[],summary:"",env:null,gitInfo:[],subTasks:[],bugList:[],press:p,testSuggest:"",uploadFiles:[],isSubmitAll:!1},testApplyTime:"",pressReasonArr:h,pressReason:f,issuetype:"",showUploadlist:[],project:{},rules:{emailTo:[{type:"array",required:!0,message:"请输入收件人",trigger:"blur"}],gitInfo:[{type:"array",required:!0,message:"请至少选择一个分支",trigger:"change"}],status:[{required:!0,message:"请选择是否进行压测评估",trigger:"change"}],reasonArr:[{required:!0,message:"请选择原因",trigger:"change"}],reason:[{required:!0,message:"请填写压测信息",trigger:"change"}]}}},watch:{report:{handler:async function(){""!=this.report?(this.data.summary=this.report.summary,this.data.emailTo=this.report.emailTo,this.data.press=this.report.press,this.data.testSuggest=this.report.testSuggest):(d.jira.getSummary(this.jiraKey).then(t=>{this.data.summary=this.jiraKey+":"+t.fields.summary}),d.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t})),await this.getTestEnv(),await this.getProjectBranch(),await this.getProjectBugList(),await this.getSubTask()},deep:!0},"$store.state.addBranch":async function(){await this.getProjectBranch()},"$store.state.delBranch":async function(){await this.getProjectBranch()},"$store.state.testEnv":async function(){await this.getTestEnv()}},async mounted(){this.data.sendUserMail=this.$store.state.user.mail,this.data.sendUserName=this.$store.state.user.displayName,""!==this.report?(this.data.jiraKey=this.report.jiraKey,this.data.summary=this.report.summary,this.data.emailTo=this.report.emailTo,this.data.press=this.report.press,this.data.testSuggest=this.report.testSuggest):""==this.report&&(this.data.jiraKey=this.jiraKey,d.jira.getSummary(this.jiraKey).then(t=>{this.data.summary=this.jiraKey+":"+t.fields.summary}),d.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t})),await this.getTestEnv(),await this.getProjectBranch(),await this.getProjectBugList(),await this.getSubTask()},methods:{preventStop(t){t.preventDefault()},getTestEnv(){d.datacenter.testEnv.findTestEnv(this.jiraKey).then(t=>{t.data.state&&(null!=t.data.ret?this.data.env=t.data.ret.env:this.data.env="暂未指定测试环境,请联系QA指定")})},getSubTask(){this.data.subTasks=[],d.jira.getSubTask(this.jiraKey).then(t=>{t.map(t=>{this.data.subTasks.push({jiraID:t.key,summary:t.fields.summary,status:t.fields.status.name})})})},getProjectBugList(){var t=this;t.data.bugList=[],d.jira.getProjectBugList(this.jiraKey,"待验证").then(e=>{e.map(function(e){t.data.bugList.push({jiraID:e.key,summary:e.fields.summary,priority:e.fields.priority.name,severity:e.fields.customfield_10241.value,rd:e.fields.customfield_10639.displayName,qa:e.fields.customfield_10640.displayName,submit:!0})})})},getProjectBranch(){var t={};d.report.getReport(this.jiraKey,"StandardTestApply").then(e=>{e.data.ret.forEach(e=>{e.gitInfo.forEach(e=>{e.submit&&(t.hasOwnProperty(e.path)||(t[e.path]=e.SHA))})})}),d.gitlab.getProjectBranch(this.jiraKey).then(e=>{var a=[];e.map(e=>{d.env.getTestJenkinsJobListByGit(e.path).then(r=>{var s={path:e.path,SHA:e.newValue,preSHA:"",server:r,defaultServer:r.length>0?r[0]:"",branch:e.branch,config:""};for(var i in t)i==e.path&&(s.preSHA=t[i]);a.push(s)})}),this.data.gitInfo=a})},cancle(){this.$emit("closeDialog")},getJiraInfo:async function(){return new Promise((t,e)=>{axios.get("/api-jiraproxy/api/findIssue?key="+this.jiraKey+"&fields=summary,status,issuetype,customfield_10710").then(e=>{this.jiraStep=e.data.ret.fields.status.name,this.issuetype=e.data.ret.fields.issuetype.name,this.testApplyTime=e.data.ret.fields.customfield_10710,t(this.jiraStep)}).catch(function(t){e(t)})})},send(t){var e=this,a=!0;if(Object.keys(this.$refs).forEach(function(t){e.$refs[t]&&e.$refs[t].validate(t=>{t||(a=!1)})}),a){e=this;var r=0;this.data.subTasks.forEach(function(t){t.submit&&(r+=1)});let t=0;if(this.data.gitInfo.forEach(e=>{e.submit&&(t+=1)}),this.data.subTasks.length==r&&(this.data.isSubmitAll=!0),this.data.gitInfo.length>0&&t<=0||this.data.gitInfo<=0)return void e.$notify.error({title:"提示",message:"提测分支不能为空"});if(this.data.subTasks.length>0&&r<=0)return void e.$notify.error({title:"提示",message:"提测子任务不能为空"});var s=[];this.data.emailTo.forEach(function(t){s.push(t+"@vipkid.com.cn")}),s.push(this.$store.state.user.mail);var i="【测试申请】"+this.data.summary+"--项目测试申请  发送人:"+this.$store.state.user.displayName,o=this.titleToHtml()+this.jiraToHtml()+this.testEnvToHtml()+this.gitInfoToHtml()+this.subTasksToHtml()+this.bugListToHtml()+this.pressToHtml()+this.testSuggestToHtml()+this.fileListToHtml(),n={receiver:s.join(",")+",zhangpengyang@vipkid.com.cn,xielin1@vipkid.com.cn,mengdeliang@vipkid.com.cn,zhuxingjun@vipkid.com.cn,changlili@vipkid.com.cn",title:i,content:o};d.report.insertOne(this.data).then(t=>{if(t.data.state){d.mailsender.send(n).then(t=>{t.data.state&&(u(20).then(t=>{e.$store.commit("changeApplyNotice",t)}),e.$notify.success({title:"提示",message:"发送测试申请成功",duration:2e3}))});var a={sendTime:t.data.sendTime,sendUser:this.$store.state.user.username,sendUserName:this.$store.state.user.displayName,isAll:this.data.isSubmitAll,gitInfo:this.data.gitInfo,subTasks:this.data.subTasks};d.datacenter.testApply.findAndUpdateTestApply(e.jiraKey,a,"已提测").then(t=>{if(t.data.state){var e=this.$store.state.user.displayName+" 发起了提测申请";d.jira.addComment(this.jiraKey,e),d.datacenter.step.findAndUpdateStep(this.jiraKey,"提测"),this.$emit("update"),this.applyTestJira()}}),this.$emit("closeDialog")}})}else console.log("valid error")},uploadFiles:function(t){var e=[];for(var a in t){var r={};r.name=t[a].name,r.url="http://10.16.16.3/"+this.jiraKey+"/report/"+t[a].name,e.push(r)}this.data.uploadFiles=e},getEmailList(t){if(this.data.emailTo=t,this.data.emailTo.length>0)for(var e in this.$refs.data.fields)"收件人"==this.$refs.data.fields[e].label&&(this.$refs.data.fields[e].resetField(),this.data.emailTo=t)},async applyTestJira(){await this.getJiraInfo(),d.timestamp.updateTime(this.jiraKey,"testApply");var t=d.jira.transitions.getTransitionType(this.jiraKey.split("-")[0],this.issuetype);if("Template for Project v11"==t){var e=(s=new d.jira.transitions_v11).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{var r={fields:{customfield_10710:c().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Tech-Project v4.0"==t){e=(s=new d.jira.transitions_tech_v1).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{r={fields:{customfield_10710:c().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Buiness Requirement Project v12"==t||"Template for Buiness Requirement Project v12.1"==t){e=(s=new d.jira.transitions_yw_v12).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{r={fields:{customfield_10710:c().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Product Requirement Project v12"==t||"Template for Product Requirement Project v12.1"==t){var s;e=(s=new d.jira.transitions_cp_v12).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{r={fields:{customfield_10710:c().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}},titleToHtml(){var t="【测试申请】"+this.data.summary+"--项目测试申请",e=new l.Table;e.setCss('width = "100%"  style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;return r.set(t,'width = "100%" style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="center"'),a.add(r),e.addTbody(a),e.toHtml()},jiraToHtml(){var t=this.jiraKey,e=new l.Table;e.setCss('width = "100%"  style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;r.set("项目信息",'colspan="2" style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);a=new l.Tr;var s=new l.Td,i=new l.Td,o=new l.A,n=new l.A;return o.set("FLow工作流地址","http://mydesktop.vipkid-qa.com.cn/#/myProjects/dev?key="+t),s.set(o,'align="center"'),n.set("Jira地址","http://jira.vipkid.com.cn/browse/"+t),i.set(n,'align="center"'),a.set([s,i]),e.addTbody(a),e.toHtml()},testEnvToHtml(){var t=this.data.env,e=new l.Table;e.setCss('style="table-layout:fixed;" border="1" cellspacing="0" cellpadding="0" width="100%"');var a=new l.Tr,r=new l.Td;return r.set("指定测试环境","width=15%"),a.add(r),(r=new l.Td).set(t),a.add(r),e.addTbody(a),e.toHtml()},gitInfoToHtml(){var t=this.data.gitInfo,e=new l.Table;e.setCss('width = "100%" style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;r.set("提测分支信息",'colspan="6" style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);a=new l.Tr;var s=new l.Td,i=new l.Td,o=new l.Td,n=new l.Td,d=new l.Td,u=new l.Td;return s.set("仓库",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),i.set("分支",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),o.set("本次提测SHA",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),n.set("上次提测SHA",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),d.set("与上次提测SHA的差异",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),u.set("是否提测",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),a.set([u,s,i,o,n,d]),e.addTbody(a),t.forEach(function(t){var a=new l.Tr,r=new l.Td,s=new l.Td,i=new l.Td,o=new l.Td,n=new l.Td,d=new l.Td;d.set(t.submit?"是":"否",'align="center"'),r.set(t.path,'align="center"'),s.set(t.branch,'align="center"'),i.set(t.SHA.substring(0,8),'align="center"'),o.set(t.preSHA.substring(0,8),'align="center"');var u=new l.A;""==t.preSHA?n.set("第一次提测",'align="center"'):""!==t.preSHA&&t.preSHA!==t.SHA?(u.set("查看详情","https://code.vipkid.com.cn/"+t.path+"/compare/"+t.preSHA+"..."+t.SHA),n.set(u,'align="center"')):""!==t.preSHA&&t.preSHA==t.SHA&&n.set("代码无变化",'align="center"'),a.set([d,r,s,i,o,n]),e.addTbody(a)}),e.toHtml()},subTasksToHtml(){var t=this.data.subTasks,e=new l.Table;e.setCss('width = "100%" style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;r.set("提测子任务",'colspan="4" style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);a=new l.Tr;var s=new l.Td,i=new l.Td,o=new l.Td,n=new l.Td;if(s.set("jiraID",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),i.set("摘要",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),o.set("状态",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),n.set("是否提测",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),a.set([s,i,o,n]),e.addTbody(a),t.length)t.forEach(function(t){var a=new l.Tr,r=new l.Td,s=new l.Td,i=new l.Td,o=new l.Td;r.set(t.jiraID,'align="center"'),s.set(t.summary,'align="center"'),i.set(t.status,'align="center"'),o.set(t.submit?"是":"否",'align="center"'),a.set([r,s,i,o]),e.addTbody(a)});else{a=new l.Tr;(s=new l.Td).set("未设置子任务",'colspan="4" align="left"'),a.add(s),e.addTbody(a)}return e.toHtml()},bugListToHtml(){var t=this.data.bugList,e=new l.Table;e.setCss('width = "100%" style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;r.set("本次提测BUG",'colspan="7" style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);a=new l.Tr;var s=new l.Td,i=new l.Td,o=new l.Td,n=new l.Td,d=new l.Td,u=new l.Td,c=new l.Td;if(s.set("jiraID",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),i.set("摘要",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),o.set("优先级",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),n.set("严重程度",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),d.set("提测人",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),u.set("修复人",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),c.set("是否提测",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),a.set([s,i,o,n,d,u,c]),e.addTbody(a),t.length)t.forEach(function(t){var a=new l.Tr,r=new l.Td,s=new l.Td,i=new l.Td,o=new l.Td,n=new l.Td,d=new l.Td,u=new l.Td;r.set(t.jiraID,'style="word-wrap:break-word;" align="left"'),s.set(t.summary,'style="word-wrap:break-word;" align="left"'),i.set(t.priority,'style="word-wrap:break-word;" align="left"'),o.set(t.severity,'style="word-wrap:break-word;" align="left"'),n.set(t.qa,'style="word-wrap:break-word;" align="left"'),d.set(t.rd,'style="word-wrap:break-word;" align="left"'),u.set(t.submit?"是":"否",'style="word-wrap:break-word;" align="left"'),a.set([r,s,i,o,n,d,u]),e.addTbody(a)});else{a=new l.Tr;(s=new l.Td).set("暂无bug待验证",'colspan="7" align="left"'),a.add(s),e.addTbody(a)}return e.toHtml()},pressToHtml(){var t=this.data.press,e=new l.Table;e.setCss('width = "100%" style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;r.set("压力测试评估",'colspan=3 style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);a=new l.Tr;var s=new l.Td,i=new l.Td;if(s.set(t[0].descrip,'style="word-wrap:break-word;" align="left"'),i.set(t[0].status,'style="word-wrap:break-word;" align="left"'),a.set([s,i]),e.addTbody(a),"是"==t[0].status){a=new l.Tr,s=new l.Td,i=new l.Td;s.set(t[1].descrip,'style="word-wrap:break-word;" align="left"'),i.set(t[1].reason,'style="word-wrap:break-word;" align="left"'),a.set([s,i]),e.addTbody(a)}else{a=new l.Tr,s=new l.Td,i=new l.Td;s.set(t[1].descrip,'style="word-wrap:break-word;" align="left"'),i.set(t[1].reasonArr.join(","),'style="word-wrap:break-word;" align="left"'),a.set([s,i]),e.addTbody(a)}return e.toHtml()},testSuggestToHtml(){var t=this.data.testSuggest,e=new l.Table;e.setCss('width = "100%" style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr;(r=new l.Td).set("测试建议",'style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);var r;a=new l.Tr;return(r=new l.Td).set(""!==t?t.replace(/\n/g,"<br>"):"暂无测试建议"),a.add(r),e.addTbody(a),e.toHtml()},fileListToHtml(){var t=this.data.uploadFiles,e=new l.Table;e.setCss('width = "100%" style="table-layout:fixed;" class="table" border="1" cellspacing="0" cellpadding="0"');var a=new l.Tr,r=new l.Td;r.set("上传附件列表",'colspan="2" style="word-wrap:break-word;color:#FFFFFF;background-color: #f85415;" class="td" align="left"'),a.add(r),e.addTbody(a);a=new l.Tr;var s=new l.Td,i=new l.Td;if(s.set("文件名称",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),i.set("下载地址",'style="word-wrap:break-word;color:#CC3300;background-color: #dedede;" align="center"'),a.set([s,i]),e.addTbody(a),t.length)t.forEach(function(t){var a=new l.Tr,r=new l.Td,s=new l.Td,i=new l.A;r.set(t.name,'align="center"'),i.set(t.url,t.url),s.set(i,'align="center"'),a.set([r,s]),e.addTbody(a)});else{a=new l.Tr;(s=new l.Td).set("无附件上传",'colspan="2" align="left"'),a.add(s),e.addTbody(a)}return e.toHtml()}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"data",staticClass:"demo-ruleForm",attrs:{model:t.data,rules:t.rules,"label-width":"50px","label-position":"right"},nativeOn:{submit:function(e){return t.preventStop(e)}}},[a("h3",[t._v("收件人")]),a("el-form-item",{attrs:{prop:"emailTo"}},[a("l_getEmail",{attrs:{emailTo:t.data.emailTo,getEmailList:t.getEmailList}})],1),a("h3",[t._v("项目名称   "),a("a",{attrs:{href:"http://jira.vipkid.com.cn/browse/"+t.data.jiraKey,target:"view_window"}},[t._v(t._s(t.data.summary))])]),a("h3",[t._v("指定测试环境   "),a("el-tag",{attrs:{type:"info"}},[t._v(t._s(t.data.env))])],1),a("el-row",[a("span",{staticClass:"tip"},[t._v("提测前请确认提测分支!!")]),a("el-table",{attrs:{data:t.data.gitInfo,"max-height":"500"}},[a("el-table-column",{attrs:{label:"本次提测",fixed:"fixed"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{name:"type",checked:"checked"},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"path",label:"仓库"}}),a("el-table-column",{attrs:{prop:"branch",label:"分支"}}),a("el-table-column",{attrs:{prop:"SHA",label:"本次提测SHA"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.SHA.substring(0,8)))])]}}])}),a("el-table-column",{attrs:{prop:"preSHA",label:"上次提测SHA"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.preSHA&&""!==e.row.preSHA?a("div",[t._v(t._s(e.row.preSHA.substring(0,8)))]):a("div",[t._v("---")])]}}])}),a("el-table-column",{attrs:{label:"与上次提测SHA的差异"},scopedSlots:t._u([{key:"default",fn:function(e){return[""!==e.row.preSHA&&e.row.preSHA!==e.row.SHA?a("a",{attrs:{href:"https://code.vipkid.com.cn/"+e.row.path+"/compare/"+e.row.preSHA+"..."+e.row.SHA,target:"view_window"}},[t._v(" 查看详情")]):t._e(),e.row.preSHA==e.row.SHA?a("div",[t._v(" 代码无变化")]):t._e(),""==e.row.preSHA?a("div",[t._v("第一次提测")]):t._e()]}}])})],1)],1),t.data.subTasks.length?a("h3",[t._v("提测子任务")]):t._e(),t.data.subTasks.length?a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.data.subTasks,"max-height":"300"}},[a("el-table-column",{attrs:{label:"本次提测",width:"100px;"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{checked:"checked"},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}})],1):t._e(),t.data.bugList.length?a("h3",[t._v("提测待验BUG")]):t._e(),t.data.bugList.length?a("el-table",{attrs:{data:t.data.bugList,"max-height":"500"}},[a("el-table-column",{attrs:{label:"本次提测",fixed:"fixed"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),a("el-table-column",{attrs:{prop:"severity",label:"严重程度"}}),a("el-table-column",{attrs:{prop:"qa",label:"提测人"}}),a("el-table-column",{attrs:{prop:"rd",label:"修复人"}})],1):t._e(),a("h3",[t._v("压力测试评估")]),a("el-table",{attrs:{data:t.getPress,border:"border","show-header":!1}},[a("el-table-column",{attrs:{width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.descrip))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.$index?a("el-form",{ref:"form1",staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"status"}},[a("el-radio-group",{model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}},[a("el-radio",{attrs:{label:e.row.label1}}),a("el-radio",{attrs:{label:e.row.label2}})],1)],1)],1):t._e(),1==e.$index&&"否"==t.data.press[0].status?a("el-form",{ref:"form2",staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"reasonArr"}},[a("el-checkbox-group",{model:{value:e.row.reasonArr,callback:function(a){t.$set(e.row,"reasonArr",a)},expression:"scope.row.reasonArr"}},[a("el-row",[a("el-checkbox",{attrs:{label:e.row.label1,name:"reasonArr"}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label2,name:"reasonArr"}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label3,name:"reasonArr"}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label4,name:"reasonArr"}})],1),a("el-row",[a("el-checkbox",{attrs:{label:e.row.label5,name:"reasonArr"}})],1)],1)],1)],1):t._e(),1==e.$index&&"是"==t.data.press[0].status?a("el-form",{ref:"form3",staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"reason"}},[a("el-input",{attrs:{type:"text"},model:{value:e.row.reason,callback:function(a){t.$set(e.row,"reason",a)},expression:"scope.row.reason"}})],1)],1):t._e()]}}])})],1),a("h3",[t._v("测试建议")]),a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:t.data.testSuggest,callback:function(e){t.$set(t.data,"testSuggest",e)},expression:"data.testSuggest"}}),a("h3",[t._v("附件")]),a("l_uploadFile",{attrs:{jiraKey:t.jiraKey,fileType:"report",showUploadlistInfo:t.showUploadlist,oninput:t.uploadFiles}}),a("el-form-item",{attrs:{align:"left"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.send("data")}}},[t._v("发送提测申请")]),a("el-button",{attrs:{size:"small"},on:{click:t.cancle}},[t._v("取消发送")])],1)],1)},staticRenderFns:[]};var b=a("VU/8")(m,g,!1,function(t){a("N0fl")},"data-v-055f8e7e",null).exports;const y=a("BAz6");var v={props:["jiraKey"],components:{l_getEmail:r.a,showForm:o,sendForm:b},data:()=>({type:"StandardTestApply",sendFormVisible:!1,showFormVisible:!1,isAreadySend:!0,tableData:[],report:[],lastApplyInfo:{info:"",status:""}}),watch:{"$store.state.applyUpdate":async function(){await this.update()}},async mounted(){this.tableData=[],await this.initHistoryApply(),await this.getLastAppplyInfo()},methods:{getLastAppplyInfo(){y.datacenter.testApply.findTestApply(this.jiraKey).then(t=>{if(t.data.ret){var e;e=t.data.ret.info.sendUserName+"--"+t.data.ret.info.sendTime+"--"+(t.data.ret.info.isAll?"全量":"非全量"),this.lastApplyInfo.info=e,this.lastApplyInfo.status=t.data.ret.status}else this.isAreadySend=!1})},submit(){this.report="",this.sendFormVisible=!0},link(t,e){this.$router.push({name:t,query:{jiraKey:e}})},initHistoryApply(){y.report.getReport(this.jiraKey,this.type).then(t=>{t.data.ret?this.tableData=t.data.ret:this.isAreadySend=!1})},redo(t,e){this.report={},this.report=t,this.sendFormVisible=!0},review(t){this.report={},this.report=t,this.showFormVisible=!0},async update(){this.isAreadySend=!0,this.tableData=[],await this.initHistoryApply(),await this.getLastAppplyInfo()}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.isAreadySend?a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("h3",{staticClass:"title"},[t._v("提测申请")]),t.lastApplyInfo.info?a("p",["打回"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"danger"}},[t._v("打回")]):t._e(),"不通过"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"danger"}},[t._v("不通过")]):t._e(),"通过"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"success"}},[t._v("通过")]):t._e(),"测试不通过"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"danger"}},[t._v("不通过")]):t._e(),"测试通过"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"success"}},[t._v("通过")]):t._e(),"已提测"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"info"}},[t._v("已提测")]):t._e(),a("span",{staticClass:"infoMessage"},[t._v(t._s(t.lastApplyInfo.info))])],1):t._e(),a("el-row",[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(e){t.link("myBugs",t.jiraKey)}}},[t._v("进入“我的BUG”")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("发送提测申请")])],1)],1),a("el-row",[t.tableData.length?a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"stripe","max-height":"300"}},[a("el-table-column",{attrs:{label:"操作",fixed:"fixed",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(a){t.redo(e.row,e.row.index)}}},[t._v("复用")])]}}])}),a("el-table-column",{attrs:{label:"查看",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(a){t.review(e.row,e.row.index)}}},[t._v("查看")])]}}])}),a("el-table-column",{attrs:{label:"全量提测",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isSubmitAll?a("el-tag",{attrs:{type:"success"}},[t._v("是")]):t._e(),e.row.isSubmitAll?t._e():a("el-tag",{attrs:{type:"danger"}},[t._v("否")])]}}])}),a("el-table-column",{attrs:{prop:"sendTime",label:"提测时间"}}),a("el-table-column",{attrs:{prop:"sendUserName",label:"提测人"}})],1):t._e()],1)],1):t._e(),t.isAreadySend?t._e():a("el-card",{attrs:{shadow:"hover"}},[a("h3",[t._v("提交测试申请")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(e){t.link("myBugs",t.jiraKey)}}},[t._v("进入“我的BUG”")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("发送提测申请")])],1),a("el-dialog",{attrs:{title:"发送提测申请",visible:t.sendFormVisible,center:"center",width:"1000px"},on:{"update:visible":function(e){t.sendFormVisible=e}}},[a("sendForm",{attrs:{jiraKey:t.jiraKey,report:t.report},on:{update:t.update,closeDialog:function(e){t.sendFormVisible=!1}}})],1),a("el-dialog",{attrs:{title:"历史提测申请",visible:t.showFormVisible,center:"center",width:"1000px"},on:{"update:visible":function(e){t.showFormVisible=e}}},[a("showForm",{attrs:{jiraKey:t.jiraKey,report:t.report},on:{closeDialog:function(e){t.showFormVisible=!1}}})],1)],1)},staticRenderFns:[]};var T=a("VU/8")(v,w,!1,function(t){a("RoM9")},"data-v-762cc7be",null);e.a=T.exports},"0rhp":function(t,e){},"162o":function(t,e,a){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,s=Function.prototype.apply;function i(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new i(s.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new i(s.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},a("mypn"),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(e,a("DuR2"))},"1Y2G":function(t,e,a){var r=a("oLzS"),s=a("Sd0T"),i=a("utyv"),o=a("uF9H"),n=a("yYhy"),l=a("Dsid"),d=r.getBCHDigit(7973);function u(t,e){return o.getCharCountIndicator(t,e)+4}function c(t,e){var a=0;return t.forEach(function(t){var r=u(t.mode,e);a+=r+t.getBitsLength()}),a}e.from=function(t,e){return n.isValid(t)?parseInt(t,10):e},e.getCapacity=function(t,e,a){if(!n.isValid(t))throw new Error("Invalid QR Code version");void 0===a&&(a=o.BYTE);var i=8*(r.getSymbolTotalCodewords(t)-s.getTotalCodewordsCount(t,e));if(a===o.MIXED)return i;var l=i-u(a,t);switch(a){case o.NUMERIC:return Math.floor(l/10*3);case o.ALPHANUMERIC:return Math.floor(l/11*2);case o.KANJI:return Math.floor(l/13);case o.BYTE:default:return Math.floor(l/8)}},e.getBestVersionForData=function(t,a){var r,s=i.from(a,i.M);if(l(t)){if(t.length>1)return function(t,a){for(var r=1;r<=40;r++)if(c(t,r)<=e.getCapacity(r,a,o.MIXED))return r}(t,s);if(0===t.length)return 1;r=t[0]}else r=t;return function(t,a,r){for(var s=1;s<=40;s++)if(a<=e.getCapacity(s,r,t))return s}(r.mode,r.getLength(),s)},e.getEncodedBits=function(t){if(!n.isValid(t)||t<7)throw new Error("Invalid QR Code version");for(var e=t<<12;r.getBCHDigit(e)-d>=0;)e^=7973<<r.getBCHDigit(e)-d;return t<<12|e}},"2hY1":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("uuDE"),s=a("HCrs"),i=a("ERWH"),o=a("09xr"),n=a("zXcN"),l=a("HGto"),d=a("thGH"),u=a("/wjd"),c=a("IceM"),p={data(){return{addItem:{key:this.jiraKey,dbIp:"",dbPort:""},envList:[],relations:[],projectList:[],targetHostList:[]}},props:["jiraKey","env","responseData","dialogVisible"],watch:{dialogVisible:function(){this.dialogVisible&&(this.envList.push({value:this.env.id,name:this.env.name}),this.addItem.env={value:this.env.id,name:this.env.name},this.relations=[],this.projectList=[],this.targetHostList=[],this.$store.state.devIntelligentRoute.length&&this.createdData())}},async created(){this.envList.push({value:this.env.id,name:this.env.name}),this.addItem.env={value:this.env.id,name:this.env.name},await this.createdData()},methods:{createdData(){if(this.$store.state.devIntelligentRoute.length){this.$store.state.devIntelligentRoute.filter(t=>"default"!=t.targetHost).forEach((t,e)=>{this.relations.push({project:{name:t.defaultServer,value:""},targetHost:{name:t.targetHost,value:""}}),this.projectList.push({0:[{name:t.defaultServer,value:""}]}),this.targetHostList.push({0:[{name:t.targetHost,value:""}]})})}},displayDialog(){this.$emit("updataButton")},addRoute(t,e){this.relations.push({targetHost:"",project:""}),this.projectList.push({0:""}),this.targetHostList.push({0:""})},deleteRoute(t,e){this.relations=this.relations.filter(function(t,a){return e!=a})},sureAddItem(){let t=this,e=!0;if(!this.relations.length)return void this.$notify.error({title:"提示",message:"路由是必填项"});if(this.relations.forEach(t=>t.project&&t.project.name?t.targetHost&&t.targetHost.name?void 0:(console.log(2),void(e=!1)):(console.log(1),void(e=!1))),!e)return void this.$notify.error({title:"提示",message:"Project Name和Target Host是必填项"});let a={env:t.addItem.env,description:t.addItem.description,key:t.addItem.key,creator:t.$store.state.user.displayName,relations:t.relations,dbIp:t.addItem.dbIp,dbPort:t.addItem.dbPort};axios.post("/api-lord/rest/api/l5d-dtab/add",a,{auth:{username:this.$store.state.user.username,password:this.$store.state.token},headers:{"Content-Type":"application/json;chartset=uft-8"}}).then(e=>{e.data.success?(this.$notify.success({title:"提示",message:"添加智能路由成功"}),t.pageNum=1,this.$emit("updataButton")):this.$notify.error({title:"提示",message:e.data.message})}).catch(t=>{this.$notify.error({title:"提示",message:"添加智能路由失败"})})}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{staticStyle:{"padding-top":"20px"}},[a("el-form",{ref:"addRefs",attrs:{model:t.addItem,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"项目key"}},[a("el-input",{attrs:{placeholder:"只能包含字母，数字和中划线，建议与Jira ID保持一致",disabled:"disabled"},model:{value:t.addItem.key,callback:function(e){t.$set(t.addItem,"key",e)},expression:"addItem.key"}})],1),a("el-form-item",{attrs:{label:"所属环境"}},[a("el-select",{attrs:{filterable:"filterable",disabled:"disabled"},model:{value:t.addItem.env,callback:function(e){t.$set(t.addItem,"env",e)},expression:"addItem.env"}},t._l(t.envList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t}})}))],1),a("el-form-item",{attrs:{label:"vkds数据库地址"}},[a("el-input",{attrs:{placeholder:"请输入vkds数据库地址"},model:{value:t.addItem.dbIp,callback:function(e){t.$set(t.addItem,"dbIp",e)},expression:"addItem.dbIp"}})],1),a("el-form-item",{attrs:{label:"端口"}},[a("el-input",{attrs:{placeholder:"请输入端口"},model:{value:t.addItem.dbPort,callback:function(e){t.$set(t.addItem,"dbPort",e)},expression:"addItem.dbPort"}})],1),a("el-form-item",{attrs:{label:"路由规则说明"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{type:"textarea",row:"3",placeholder:"请输入路由规则说明"},model:{value:t.addItem.description,callback:function(e){t.$set(t.addItem,"description",e)},expression:"addItem.description"}})],1)],1)],1)],1),t.relations.length<1?a("div",{staticClass:"routerTip"},[a("span",[t._v("Tip:  执行智能路由时,必须选择targetHost(值不能为default)")])]):t._e(),t.relations.length>=1?a("el-card",{staticStyle:{"margin-top":"20px"}},[a("el-table",{attrs:{data:t.relations}},[a("el-table-column",{attrs:{label:"操作","min-width":"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.relations.length>1?a("el-button",{attrs:{type:"danger",size:"small",disabled:"disabled"},on:{click:function(a){t.deleteRoute(e.row,e.$index)}}},[t._v("删除")]):t._e(),t.relations.length==e.$index+1?a("el-button",{attrs:{type:"primary",size:"small",disabled:"disabled"},on:{click:function(a){t.addRoute(e.row,e.$index)}}},[t._v("增加")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"Project Name","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{filterable:"filterable",remote:"remote","reserve-keyword":"reserve-keyword",placeholder:"请选择服务名",disabled:"disabled"},model:{value:e.row.project,callback:function(a){t.$set(e.row,"project",a)},expression:"scope.row.project"}},t._l(t.projectList[e.$index][0],function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t}})}))]}}])}),a("el-table-column",{attrs:{label:"Target Host","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{filterable:"filterable",placeholder:"对应的Drone机器名",disabled:"disabled"},model:{value:e.row.targetHost,callback:function(a){t.$set(e.row,"targetHost",a)},expression:"scope.row.targetHost"}},t._l(t.targetHostList[e.$index][0],function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t}})}))]}}])})],1)],1):t._e(),t.relations.length>=1?a("div",{staticClass:"btn"},[a("el-button",{staticClass:"clear",attrs:{type:"danger"},on:{click:t.sureAddItem}},[t._v("提交")])],1):t._e()],1)},staticRenderFns:[]};var f={data:()=>({dialogVisible:!1,isTrue:!1,responseData:[],env:{},data:[]}),props:["jiraKey"],components:{createRouteContent:a("VU/8")(p,h,!1,function(t){a("wopq")},"data-v-7605ffdc",null).exports},watch:{"$store.state.devEnv":function(){this.getRouterInfo()}},mounted(){this.getRouterInfo()},methods:{updataButton(){this.dialogVisible=!1,this.getInfo(this.env)},getRouterInfo(){this.$API.getRouterEnvList().then(t=>{let e=t.data.data;if(e.length){let t=e.filter((t,e)=>t.name==this.$store.state.devEnv);t.length>0?(this.isTrue=!0,this.getInfo(t[0])):this.isTrue=!1}}).catch(t=>{console.log(t)})},createRoute(){this.dialogVisible=!0},getInfo(t){this.$API.getRouterEnv({endpointParams:{jiraKey:this.jiraKey,envId:t.id}}).then(e=>{this.env=t,this.data=e.data.data}).catch(t=>{console.log(t)})}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.isTrue?a("el-card",{attrs:{shadow:"hover"}},[a("el-row",{staticClass:"cfg"},[a("h3",[t._v("智能路由")]),0==t.data.length?a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.createRoute}},[t._v("执行智能路由")]):t._e()],1),a("el-row",[t.data.length>0?a("el-table",{attrs:{data:t.data}},[a("el-table-column",{attrs:{label:"域名","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.domainNames?a("div",t._l(e.row.domainNames.split(";"),function(e){return a("div",{staticClass:"div-a"},[a("a",{attrs:{href:"http://"+e,target:"_blank"}},[t._v(t._s("http://"+e))])])})):t._e()]}}])}),a("el-table-column",{attrs:{label:"路由规则","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"left",title:"路由规则",width:"200",trigger:"hover",content:e.row.value}},[a("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v("查看")])],1)]}}])})],1):t._e()],1),a("el-dialog",{attrs:{title:"执行智能路由",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("createRouteContent",{attrs:{jiraKey:t.jiraKey,env:t.env,dialogVisible:t.dialogVisible},on:{updataButton:t.updataButton}})],1)],1):t._e()},staticRenderFns:[]};var g=a("VU/8")(f,m,!1,function(t){a("rRYa")},"data-v-4eb205d6",null).exports,b=(a("Ha91"),a("+Te1")),y={props:["tables","index","select"],data:()=>({selectOption:[],branch:""}),watch:{branch:{handler:function(){this.changeBranch(this.branch)},deep:!0},selectOption:{handler:function(){"master"==this.branch&&this.changeBranch(this.branch)},deep:!0}},mounted(){this.branch=this.select},methods:{refurbish(t){this.selectOption=t},changeBranch(t){this.selectOption.map(e=>{if(e.name==t){let t={index:this.index,branchData:e};this.$emit("changeBranch",t)}})},getGitRef(t){this.$API.getGitRef({endpointParams:{project:t.gitRepositoryUrl}}).then(t=>{this.selectOption=t.data,console.log(this.selectOption)}).catch(t=>{console.log(t)})}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-select",{model:{value:t.branch,callback:function(e){t.branch=e},expression:"branch"}},t._l(t.selectOption,function(t,e){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}))},staticRenderFns:[]},w=a("VU/8")(y,v,!1,null,null,null).exports,T={props:["scope"],data:()=>({}),watch:{},mounted(){},methods:{}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-radio-group",{model:{value:t.scope.row.checkout,callback:function(e){t.$set(t.scope.row,"checkout",e)},expression:"scope.row.checkout"}},[a("el-radio",{attrs:{label:"new"}},[t._v("打包新版本"+t._s(t.scope.row.current?t.scope.row.current[0]:"---"))]),a("el-radio",{attrs:{label:"old"}},[t._v("选择已有版本"),a("el-select",{staticStyle:{width:"100px"},model:{value:t.scope.row.version,callback:function(e){t.$set(t.scope.row,"version",e)},expression:"scope.row.version"}},t._l(t.scope.row.history,function(t,e){return a("el-option",{key:e,attrs:{value:t,label:t}})}))],1)],1)},staticRenderFns:[]},k={data:()=>({selectOption:[],app:"master",datas:[],version:[],projectModuleData:[],disData:[],keys:Math.random(),versionList:[],selectOptionList:["master","0.0.1"]}),components:{moduleBranch:w,tagBranch:a("VU/8")(T,_,!1,null,null,null).exports},props:["dialogVisibleInfo","jiraKey"],async created(){this.$store.state.configModules&&(await this.getGitRef(),await this.initData(),await this.getAppVersion("master"))},watch:{dialogVisibleInfo:async function(){this.dialogVisibleInfo&&await this.initData()}},methods:{getGitRef(){let t=this.$store.state.configModules[0];this.$API.getGitRef({endpointParams:{project:t.gitRepositoryUrl}}).then(t=>{this.selectOption=t.data;let e=this.selectOption.filter(t=>"master"==t.name);this.app=e[0]}).catch(t=>{console.log(t)})},changeApp(){this.getAppVersion(this.app.name)},getAppVersion(t){let e=this.$store.state.configModules[0];this.version=[],this.$API.getAppVersion({endpointParams:{branch:t,appName:e.appName,projectUrl:e.gitRepositoryUrl}}).then(t=>{this.version=t.data.data}).catch(t=>{console.log(t)})},changeModule(t){},changeBranch(t){let e=this.datas[t.index];this.$API.getVersion({endpointParams:{projectUrl:e.gitRepositoryUrl,branch:t.branchData.name,moduleName:e.name}}).then(a=>{let r=a.data.data;e.current=r.current,e.history=r.history,e.version=e.history?e.history[0]:[],this.change(t.index)}),e.branchObj=t.branchData,this.$forceUpdate()},initData(){let t=this.$store.state.configModules.slice(1).map(t=>(t.selectOption=[],this.$API.getGitRef({endpointParams:{project:t.gitRepositoryUrl}}).then(e=>{t.selectOption=e.data,this.$refs.moduleBranch.refurbish(e.data)}).catch(t=>{console.log(t)}),t.branch="master",t.pid=t.id,t.checkout="",t.checkout="new",this.$API.getVersion({endpointParams:{projectUrl:t.gitRepositoryUrl,branch:t.branch,moduleName:t.name}}).then(e=>{let a=e.data.data;t.current=a.current,t.history=a.history,t.version=t.history?t.history[0]:[]}),t));this.$forceUpdate(),this.datas=t},handleSelectionChange(t){this.projectModuleData=t},disDialog(){this.$emit("disDialog")},change(t){let e=this.datas[t];this.datas.splice(t,1,e),this.$store.commit("changetagModules",this.datas)},changeVersion(){this.$forceUpdate()},toCommit(){let t="";if(!this.projectModuleData.length)return void this.$notify.error({message:"请选择打包某块"});if(this.projectModuleData.map(e=>{let a="";"new"!=e.checkout||(a=e.current[0],-1==e.history.indexOf(a))||(t=`${e.name}模块历史版本包含此版本，请选择历史版本`)}),t)return void this.$notify.error({message:t});let e=this.$store.state.configModules[0],a=this.projectModuleData.map(t=>{let e="";return"new"==t.checkout?e=t.current[0]:"old"==t.checkout&&(e=t.version),{mid:t.id,version:e,realizationOptions:[]}}),r=this.projectModuleData.map(t=>{let a="";return"new"==t.checkout?a=t.current[0]:"old"==t.checkout&&(a=t.version),{application:{versionStatus:t.checkout,pid:e.id,mid:t.id,branch:t.branchObj.name,version:a,assignee:this.$store.state.user.displayName,doc:"",commitid:t.branchObj.commit.id}}}),s={assemble:{commitid:this.app.commit.id,name:e.name,version:this.version[0],operator:this.$store.state.user.displayName,assembleIdentify:"debug",pid:e.id,realizationModules:a,realizationOptions:[],jiraKey:this.jiraKey,downUrl:e.downUrl},detail:r};this.$API.submitModule({data:s}).then(t=>{console.log(t),this.$emit("successDialog")}).catch(t=>{this.$notify.error({message:"主工程打包失败"})})}}},j={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{attrs:{size:"small","label-width":"100px"}},[a("el-form-item",{attrs:{label:"App分支:"}},[a("el-select",{attrs:{"value-key":"name"},on:{change:t.changeApp},model:{value:t.app,callback:function(e){t.app=e},expression:"app"}},t._l(t.selectOption,function(t,e){return a("el-option",{key:t.name,attrs:{label:t.name,value:t}})}))],1),a("el-form-item",{attrs:{label:"App version:"}},[a("span",[t._v(t._s(t.version?t.version[0]:"--"))])]),a("el-form-item",{attrs:{label:"依赖模块:"}},[a("el-table",{attrs:{data:t.datas},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{label:"选择",type:"selection"}}),a("el-table-column",{attrs:{label:"模块名称",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name?e.row.name:""))])]}}])}),a("el-table-column",{attrs:{label:"版本",width:"225px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-radio-group",{on:{change:function(a){t.change(e.$index)}},model:{value:e.row.checkout,callback:function(a){t.$set(e.row,"checkout",a)},expression:"scope.row.checkout"}},[a("el-radio",{attrs:{label:"new"}},[t._v("打包新版本"+t._s(e.row.current?e.row.current[0]:"---"))]),a("el-radio",{attrs:{label:"old"}},[t._v("选择已有版本"),a("el-select",{staticStyle:{width:"100px"},on:{change:function(a){t.change(e.$index)}},model:{value:e.row.version,callback:function(a){t.$set(e.row,"version",a)},expression:"scope.row.version"}},t._l(e.row.history,function(t,e){return a("el-option",{key:e,attrs:{value:t,label:t}})}))],1)],1)]}}])}),a("el-table-column",{attrs:{label:"git",prop:"gitRepositoryUrl",width:"200"}}),a("el-table-column",{attrs:{label:"分支",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("moduleBranch",{ref:"moduleBranch",attrs:{tables:e.row.selectOption,index:e.$index,select:"master"},on:{changeBranch:t.changeBranch}})]}}])})],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.toCommit}},[t._v("确定")]),a("el-button",{attrs:{type:"danger"},on:{click:t.disDialog}},[t._v("取消")])],1)],1)},staticRenderFns:[]},I=a("VU/8")(k,j,!1,null,null,null).exports,S=a("162o"),x={props:["jiraKey"],components:{tables:b.a,configAssembler:I},data:()=>({dialogVisibleInfo:!1,tableData:[],taskList:[],timer:null,rules:{jenkins_subjob_name:[{required:!0,message:"请选择测试任务",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}]}}),mounted(){this.getAutoStepList()},methods:{getAutoStepList(){this.$API.getProjectDetail({endpointParams:{jiraKey:this.jiraKey,assembleIdentify:"debug"}}).then(({data:t})=>{if(this.tableData=t,this.tableData!=[]){let t=0;for(var e=0;e<this.tableData.length;e++)if("PENDING"==this.tableData[e].status){t++;break}t>0?this.timer?Object(S.clearInterval)(this.timer):this.timer=setInterval(()=>{this.getAutoStepList()},5e5):Object(S.clearInterval)(this.timer)}}).catch(t=>{console.log(t)})},toConfig(){this.dialogVisibleInfo=!0},disDialog(){this.dialogVisibleInfo=!1},successDialog(){this.getAutoStepList(),this.dialogVisibleInfo=!1}}},A={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{attrs:{shadow:"hover"}},[a("el-row",{staticClass:"cfg"},[a("h3",[t._v("提测")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.toConfig}},[t._v("装配")])],1),a("el-row",[a("tables",{attrs:{tableData:t.tableData}})],1),a("el-dialog",{attrs:{title:"主打包工程",visible:t.dialogVisibleInfo,width:"60%"},on:{"update:visible":function(e){t.dialogVisibleInfo=e}}},[a("configAssembler",{attrs:{dialogVisibleInfo:t.dialogVisibleInfo,jiraKey:t.jiraKey},on:{disDialog:t.disDialog,successDialog:t.successDialog}})],1)],1)},staticRenderFns:[]};var C=a("VU/8")(x,A,!1,function(t){a("0rhp")},"data-v-66dc2db8",null).exports,$={data:()=>({data:[{project:null}],parentLists:[],app:"",parentModule:[],appValue:""}),props:["jiraKey"],mounted(){this.parentList()},watch:{"$store.state.configModules":function(){this.$store.state.configModules&&this.parentList()}},methods:{parentList(){this.$API.getParentList({endpointParams:{jiraKey:this.jiraKey}}).then(t=>{if(this.parentLists=t.data,this.$store.state.configModules){let t=this.$store.state.configModules.slice(0,1)[0],e=this.parentLists.filter(e=>e.name==t.name);this.app=e[0],this.parentModule=e[0].parentModules;let a=this.$store.state.configModules.slice(1);this.data=a.map(t=>({project:t})),a.unshift(this.app)}}).catch(t=>{})},changeModule(t){this.parentModule=t.parentModules,this.data=[{project:null}]},addItem(){this.data.push({project:null})},removeItem(t){this.data=this.data.filter(function(e,a){return t!=a})},sureConfig(){let t=this.data.map(t=>(delete t.project.id,t.project.jiraKey=this.jiraKey,t.project));delete this.app.id,this.app.jiraKey=this.jiraKey,this.app.modules=t,this.$API.projectCreate({data:this.app}).then(t=>{200==t.resp.status?(this.$notify.success({message:"配置APP成功"}),this.$emit("successUpdata",t.data)):this.$notify.error({message:"配置APP失败"})}).catch(t=>{console.log(t)})},deleteConfig(){this.$emit("disDialog"),this.app="",this.data=[{project:null}]}}},E={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{attrs:{"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"App:"}},[a("el-select",{attrs:{"value-key":"name"},on:{change:t.changeModule},model:{value:t.app,callback:function(e){t.app=e},expression:"app"}},t._l(t.parentLists,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t}})}))],1),a("el-form-item",{attrs:{label:"所需模块:"}},[a("el-table",{attrs:{data:t.data,size:"small"}},[a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary"},on:{click:t.addItem}},[t._v("新增")]),t.data.length>1&&0!==e.$index?a("el-button",{attrs:{type:"danger"},on:{click:function(a){t.removeItem(e.$index)}}},[t._v("删除")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{"value-key":"name"},model:{value:e.row.project,callback:function(a){t.$set(e.row,"project",a)},expression:"scope.row.project"}},t._l(t.parentModule,function(t,e){return a("el-option",{key:t.name,attrs:{label:t.name,value:t}})}))]}}])})],1),a("div",{staticClass:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.sureConfig}},[t._v("确定")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:t.deleteConfig}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]};var D={props:["jiraKey"],components:{assableerConfig:a("VU/8")($,E,!1,function(t){a("5D8C")},null,null).exports},data:()=>({data:[],dialogVisibleInfo:!1}),mounted(){this.projectList()},methods:{projectList(){this.$API.projectList({endpointParams:{jiraKey:this.jiraKey}}).then(t=>{let e=t.data;if(e[0].modules.length){let t=e[0].modules;t.unshift(e[0]),this.data=t,this.$store.commit("changeModules",this.data)}else this.data=[],this.$store.commit("changeModules",[])}).catch(t=>{})},toAddTable(){this.dialogVisibleInfo=!0},disDialog(){this.dialogVisibleInfo=!1},successUpdata(t){this.dialogVisibleInfo=!1;let e=t,a=e.modules;a.unshift(e),this.data=a,this.$store.commit("changeModules",this.data)}}},K={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",[a("h3",[t._v("配置App"),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.toAddTable}},[t.data.length<=0?a("i",{staticClass:"el-icon-plus"}):a("i",{staticClass:"el-icon-edit"})])],1),a("el-table",{attrs:{data:t.data}},[a("el-table-column",{attrs:{label:"类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.$index?a("span",[t._v("主工程")]):a("span",[t._v("模块")])]}}])}),a("el-table-column",{attrs:{label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"仓库"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.gitRepositoryUrl))])]}}])})],1)],1),a("el-dialog",{attrs:{title:"配置APP、模块",visible:t.dialogVisibleInfo,width:"70%"},on:{"update:visible":function(e){t.dialogVisibleInfo=e}}},[a("assableerConfig",{attrs:{jiraKey:t.jiraKey},on:{disDialog:t.disDialog,successUpdata:t.successUpdata}})],1)],1)},staticRenderFns:[]},B=a("VU/8")(D,K,!1,null,null,null).exports;const F=a("BAz6");var P={name:"kaifa",components:{planDocStep:r.a,devEnvConfigStep:s.a,devBranchStep:i.a,testApplyStep:o.a,clientTestApplyStep:n.a,selfTestReportStep:l.a,manualCaseConfirmStep_express:d.a,qaConfirmStep:u.a,preDeployStep:c.a,devIntelligentRouteStep:g,clientAssemblerInfo:C,clientConfigApp:B},data:()=>({breadcrumb:null,key:"",template:"",project:null,CIValue:""}),mounted(){this.key=this.$route.query.key,F.jira.getProjectInfo(this.key).then(t=>{this.project=t,this.template=this.project.fields.customfield_10400.value,this.CIValue=this.project.fields.customfield_10818?this.project.fields.customfield_10818.value:null,this.breadcrumb=[{label:"开发阶段",path:"/myProjects/dev",query:{key:this.key}}]})},methods:{}},R={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},t._l(t.breadcrumb,function(e,r){return a("el-breadcrumb-item",{key:r,attrs:{to:{path:e.path}}},[t._v(t._s(e.label))])}))],1),t.project?a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("h3",[a("a",{attrs:{href:"http://jira.vipkid.com.cn/browse/"+t.project.key,target:"view_window"}},[t._v(t._s(t.project.key)+" : "+t._s(t.project.fields.summary)+"   ")]),"标准通道"==t.template?a("el-tag",[t._v(t._s(t.template))]):t._e(),"绿色通道"==t.template?a("el-tag",{attrs:{type:"success"}},[t._v(t._s(t.template))]):t._e(),"客户端通道"!=t.project.template||t.CIValue&&"启用CI/CD"==t.CIValue?t._e():a("el-tag",{attrs:{type:"warning"}},[t._v(t._s(t.template))]),"客户端通道"==t.template&&"启用CI/CD"==t.CIValue?a("el-tag",{staticClass:"templateCi"},[t._v("客户端CI/CD通道")]):t._e()],1)]),"标准通道"==t.template?a("el-col",{attrs:{span:18}},[a("devEnvConfigStep",{attrs:{jiraKey:t.key}}),a("devIntelligentRouteStep",{attrs:{jiraKey:t.key}}),a("devBranchStep",{attrs:{jiraKey:t.key}}),a("testApplyStep",{attrs:{jiraKey:t.key}})],1):t._e(),"绿色通道"==t.template?a("el-col",{attrs:{span:18}},[a("devEnvConfigStep",{attrs:{jiraKey:t.key}}),a("devIntelligentRouteStep",{attrs:{jiraKey:t.key}}),a("devBranchStep",{attrs:{jiraKey:t.key}}),a("manualCaseConfirmStep_express",{attrs:{jiraKey:t.key}}),a("qaConfirmStep",{attrs:{jiraKey:t.key}}),a("preDeployStep",{attrs:{jiraKey:t.key}}),a("selfTestReportStep",{attrs:{jiraKey:t.key}})],1):t._e(),"客户端通道"!=t.template||t.CIValue&&"启用CI/CD"==t.CIValue?t._e():a("el-col",{attrs:{span:18}},[a("clientTestApplyStep",{attrs:{jiraKey:t.key}})],1),"客户端通道"==t.template&&"启用CI/CD"==t.CIValue?a("el-col",{attrs:{span:18}},[a("clientConfigApp",{attrs:{jiraKey:t.key}}),a("clientAssemblerInfo",{attrs:{jiraKey:t.key}}),a("clientTestApplyStep",{attrs:{jiraKey:t.key}})],1):t._e(),a("el-col",{attrs:{span:6}},[a("planDocStep",{attrs:{jiraKey:t.key}})],1)],1):t._e()],1)},staticRenderFns:[]};var H=a("VU/8")(P,R,!1,function(t){a("E0GG")},"data-v-97fbf1fa",null);e.default=H.exports},"5D8C":function(t,e){},"71e1":function(t,e,a){var r=a("cJP9"),s=a("WEzc"),i=a("9ff9"),o=a("729m");function n(t,e,a,i,o){var n=[].slice.call(arguments,1),l=n.length,d="function"==typeof n[l-1];if(!d&&!r())throw new Error("Callback required as last argument");if(!d){if(l<1)throw new Error("Too few arguments provided");return 1===l?(a=e,e=i=void 0):2!==l||e.getContext||(i=a,a=e,e=void 0),new Promise(function(r,o){try{var n=s.create(a,i);r(t(n,e,i))}catch(t){o(t)}})}if(l<2)throw new Error("Too few arguments provided");2===l?(o=a,a=e,e=i=void 0):3===l&&(e.getContext&&void 0===o?(o=i,i=void 0):(o=i,i=a,a=e,e=void 0));try{var u=s.create(a,i);o(null,t(u,e,i))}catch(t){o(t)}}e.create=s.create,e.toCanvas=n.bind(null,i.render),e.toDataURL=n.bind(null,i.renderToDataURL),e.toString=n.bind(null,function(t,e,a){return o.render(t,a)})},"729m":function(t,e,a){var r=a("nwDn");function s(t,e){var a=t.a/255,r=e+'="'+t.hex+'"';return a<1?r+" "+e+'-opacity="'+a.toFixed(2).slice(1)+'"':r}function i(t,e,a){var r=t+e;return void 0!==a&&(r+=" "+a),r}e.render=function(t,e,a){var o=r.getOptions(e),n=t.modules.size,l=t.modules.data,d=n+2*o.margin,u=o.color.light.a?"<path "+s(o.color.light,"fill")+' d="M0 0h'+d+"v"+d+'H0z"/>':"",c="<path "+s(o.color.dark,"stroke")+' d="'+function(t,e,a){for(var r="",s=0,o=!1,n=0,l=0;l<t.length;l++){var d=Math.floor(l%e),u=Math.floor(l/e);d||o||(o=!0),t[l]?(n++,l>0&&d>0&&t[l-1]||(r+=o?i("M",d+a,.5+u+a):i("m",s,0),s=0,o=!1),d+1<e&&t[l+1]||(r+=i("h",n),n=0)):s++}return r}(l,n,o.margin)+'"/>',p='viewBox="0 0 '+d+" "+d+'"',h='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+p+' shape-rendering="crispEdges">'+u+c+"</svg>\n";return"function"==typeof a&&a(null,h),h}},"9ff9":function(t,e,a){var r=a("nwDn");e.render=function(t,e,a){var s=a,i=e;void 0!==s||e&&e.getContext||(s=e,e=void 0),e||(i=function(){try{return document.createElement("canvas")}catch(t){throw new Error("You need to specify a canvas element")}}()),s=r.getOptions(s);var o=r.getImageWidth(t.modules.size,s),n=i.getContext("2d"),l=n.createImageData(o,o);return r.qrToImageData(l.data,t,s),function(t,e,a){t.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=a,e.width=a,e.style.height=a+"px",e.style.width=a+"px"}(n,i,o),n.putImageData(l,0,0),i},e.renderToDataURL=function(t,a,r){var s=r;void 0!==s||a&&a.getContext||(s=a,a=void 0),s||(s={});var i=e.render(t,a,s),o=s.type||"image/png",n=s.rendererOpts||{};return i.toDataURL(o,n.quality)}},"9jEu":function(t,e,a){var r=a("oLzS").getSymbolSize;e.getRowColCoords=function(t){if(1===t)return[];for(var e=Math.floor(t/7)+2,a=r(t),s=145===a?26:2*Math.ceil((a-13)/(2*e-2)),i=[a-7],o=1;o<e-1;o++)i[o]=i[o-1]-s;return i.push(6),i.reverse()},e.getPositions=function(t){for(var a=[],r=e.getRowColCoords(t),s=r.length,i=0;i<s;i++)for(var o=0;o<s;o++)0===i&&0===o||0===i&&o===s-1||i===s-1&&0===o||a.push([r[i],r[o]]);return a}},DEuz:function(t,e){function a(){this.buffer=[],this.length=0}a.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var a=0;a<e;a++)this.putBit(1==(t>>>e-a-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}},t.exports=a},Dsid:function(t,e){var a={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==a.call(t)}},E0GG:function(t,e){},ERWH:function(t,e,a){"use strict";const r=a("7OuW"),s=a("BAz6");var i={props:{jiraKey:{type:String,default:null},signal:{type:String,default:null}},data:()=>({dialogFormVisible:!1,options:[],loading:!1,ruleForm:{keyword:"",newBranch:"",oldBranch:"master"},rules:{keyword:[{required:!0,message:"请输入代码仓库名称",trigger:"blur"}],newBranch:[{required:!0,message:"请输入新的分支名称",trigger:"blur"},{pattern:/^[A-Za-z0-9\-\_]+$/,message:"不允许输入空格等特殊符号"},{pattern:/^(?!.*(revert-))(.*)$/,message:"不允许以revert开头,此分支命名为revert操作保留"}],oldBranch:[]},msg:"请遵守分支规范创建分支, 如未提交工单请先提交工单进行申请",wiki:"参考wiki地址:  http://wiki.vipkid.com.cn/pages/viewpage.action?pageId=28942309"}),watch:{signal:function(){this.dialogFormVisible=!0}},mounted(){},computed:{newName:function(){return s.tools.trim(this.ruleForm.newBranch)+"_"+this.jiraKey}},methods:{open(){this.dialogFormVisible=!0,this.ruleForm.keyword="",this.ruleForm.newBranch="",this.$refs.ruleForm&&this.$refs.ruleForm.resetFields()},createBranch(){this.$refs.ruleForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;var e={path:this.ruleForm.keyword,branch:this.newName,ref:"master"};this.dialogFormVisible=!1,axios.post("/api-gitproxy/api/createBranch",e).then(t=>{t.data.state?(this.$emit("update"),this.$notify.success({title:"",message:"创建分支成功",showClose:!1}),r(20).then(t=>{this.$store.commit("changeAddBranch",t)})):this.$notify.error({title:"",message:t.data.info,showClose:!1})}).catch(function(t){})})},remoteMethod(t){var e=this;t?(e.loading=!0,e.options=[],axios.get("/api-config/api/jira2git/page?length=1000000&search="+t).then(t=>{t.data.ret.forEach(function(t){e.options.push({label:t.path})}),e.loading=!1}).catch(function(t){e.options=[],e.loading=!1})):(e.loading=!1,e.options=[])}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-button",{staticClass:"view",attrs:{type:"primary",size:"mini"},on:{click:t.open}},[t._v("创建分支")]),a("el-dialog",{staticClass:"add",attrs:{title:"创建分支",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-alert",{attrs:{title:t.msg,type:"warning","show-icon":"show-icon"}},[a("p",[t._v("如有疑问,请联系管理员孙定博 (R&D)")])]),a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{"margin-top":"8px"},attrs:{model:t.ruleForm,rules:t.rules,"label-width":"180px"}},[a("el-form-item",{attrs:{label:"代码仓库后缀",prop:"keyword"}},[a("el-select",{staticStyle:{width:"65%"},attrs:{filterable:"filterable",remote:"remote","reserve-keyword":"reserve-keyword",placeholder:"请输入Git仓库后缀信息,例:/EP/gitHooks","remote-method":t.remoteMethod,loading:t.loading},model:{value:t.ruleForm.keyword,callback:function(e){t.$set(t.ruleForm,"keyword",e)},expression:"ruleForm.keyword"}},t._l(t.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.label}},[a("span",[t._v(t._s(e.label))])])})),a("el-button",{staticStyle:{width:"30%","margin-left":"5px"},attrs:{type:"warning"}},[a("a",{staticClass:"dingding",attrs:{href:"dingtalk://dingtalkclient/action/sendmsg?dingtalk_id=1rd_4d8019ebol"}},[t._v("找不到仓库求助")])])],1),a("el-form-item",{attrs:{label:"输入分支名称",prop:"newBranch"}},[a("el-input",{staticStyle:{width:"65%",float:"left"},attrs:{placeholder:"请输入新的分支名称,默认后缀增加_JiraKey"},model:{value:t.ruleForm.newBranch,callback:function(e){t.$set(t.ruleForm,"newBranch",e)},expression:"ruleForm.newBranch"}})],1),a("el-form-item",{attrs:{label:"预览分支名称"}},[a("label",[t._v(t._s(t.newName))])]),a("el-form-item",{attrs:{label:"来源分支名称"}},[a("label",[t._v(t._s(t.ruleForm.oldBranch))])])],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.createBranch}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(i,o,!1,function(t){a("onfh")},"data-v-1e678168",null).exports,l=a("xjwK"),d=a("vDzZ"),u=a("W5mV"),c=a("A2Hi");const p=a("PJh5"),h=a("7OuW"),f=a("BAz6");var m={props:{jiraKey:{type:String,default:null},gitInfo:{type:Object,default:null}},data:()=>({id:null,state:null,stateType:null,loading:!1,uuid:null,btnName:"部署"}),created(){},watch:{"$store.state.update":async function(){await this.getJobState()}},mounted(){this.getJobState()},methods:{getJobState(){const t={deployType:"devDeploy",jiraKey:this.jiraKey,branchName:this.gitInfo.branch,gitPath:this.gitInfo.gitPath};f.jenkins.getDeployInfo(t).then(t=>{t?("SUCCESS"===t.state&&(this.btnName="部署",this.stateType="SUCCESS"),"ABORTED"===t.state&&(this.btnName="部署",this.stateType="ABORTED"),"FAILURE"===t.state&&(this.btnName="部署",this.stateType="FAILURE"),"PENDING"!==t.state&&"STARTED"!==t.state||(this.btnName="部署ing.",this.stateType="PENDING",this.loading=!0)):(this.btnName="部署",this.stateType="SUCCESS")}).catch(t=>{console.log(t)})},refresh(){var t=this;t.id&&clearInterval(t.id),t.id=setInterval(()=>{f.jenkins.getStateInfo(t.uuid).then(e=>{e&&(t.stateType=e.state,t.state=e.state,"PADDING"===e.state||"STARTED"===e.state?t.loading=!0:(t.loading=!1,h(20).then(t=>{this.$store.commit("changeDeploy",t)}),clearInterval(t.id)))}).catch(t=>{})},1e3)},buildJob(t){const e={name:"flow_deploy",parameters:{creator:this.$store.state.user.displayName,creatorEmail:this.$store.state.user.mail,creatorPhone:this.$store.state.user.phone,jiraKey:this.jiraKey,type:"deploy",gitPath:t.gitPath,whicha:this.$store.state.devEnv,config:t.config,server:t.defaultServer,target_host:t.targetHost,repository:"origin",branch:t.branch,commitSha:t.curSha,folder:"CLASVPS"!==this.jiraKey.split("-")[0]?"env-deploy":"onlineclass"}},a={jiraKey:this.jiraKey,gitPath:t.gitPath,deployType:"devDeploy",serverName:t.defaultServer,targetHost:t.targetHost,branchName:t.branch,userName:this.$store.state.user.displayName,env:this.$store.state.devEnv};t.targetHost.length>0?f.jenkins.devDeploy(e,a).then(e=>{e&&(this.uuid=e,h(20).then(e=>{var a=e,r=null,s=this.$store.state.devEnv+"环境"+t.defaultServer+"服务发生变更!\n详情如下: \n仓库地址: "+t.gitPath+"\n分支: "+t.branch+"\nSHA: "+t.curSha.substring(0,8)+"\n变更人为: "+this.$store.state.user.displayName+"\n变更时间为: "+p(new Date).format("YYYY-MM-DD HH:mm:ss");axios.get("/api-traceback/api/env/find?env="+this.$store.state.devEnv).then(e=>{for(var i in e.data.ret)if(e.data.ret[i].serverName==t.defaultServer&&e.data.ret[i].creatorEmail!=this.$store.state.user.mail){r=e.data.ret[i].creatorEmail.split("@")[0];break}r?(f.message.insertMessage(a,r,this.$store.state.user.displayName,s).then(t=>{}).catch(t=>{}),this.$notify.success({title:"提示",message:"已执行环境部署,请查看jenkins状态",duration:1e3}),this.refresh()):(this.$notify.success({title:"提示",message:"已执行环境部署,请查看jenkins状态",duration:1e3}),this.refresh())}).catch(t=>{})}))}).catch(t=>{console.log(t),this.$notify({title:"提示",message:"部署环境失败,请联系管理员",duration:1e3})}):this.$notify.error({title:"提示",message:"请选择targetHost",duration:1e3})},buildEnv(t){this.$store.state.devEnv?t.defaultServer?f.jira.checkoutEnv(this.$store.state.devEnv,this.jiraKey).then(e=>{if(e.state)if(0==e.status)this.buildJob(t);else if(1==e.status)this.buildJob(t);else if(2==e.status){let t=e.epicKey;this.$notify({title:"提示",dangerouslyUseHTMLString:!0,message:`<a href=http://jira.vipkid.com.cn/browse/${t} target="_black">项目：${t}，正在使用该环境，请线下联系该项目人员或者变更环境</a>`,duration:2e3})}else if(3==e.status){let a="";if(e.jiraList.length>0){e.jiraList.map(t=>(a+="<a href=http://jira.vipkid.com.cn/browse/"+t+' target="_black">项目：'+t+"</a><br>",t+","));a+="<h3>上述项目正在使用该环境，请线下联系相关人员</h3><br>",this.$notify.warning({title:"提示",dangerouslyUseHTMLString:!0,message:a,duration:2e3})}else this.buildJob(t)}else 4==e.status&&this.buildJob(t);else console.log("环境校验异常，请联系管理员"),this.$notify.success({title:"提示",message:"环境部署失败",duration:1e3})}).catch(t=>{console.log(t),console.log("环境校验失败，请联系管理员"),this.$notify.success({title:"提示",message:"环境部署失败",duration:1e3})}):this.$notify({title:"提示",message:"请选择部署的服务",duration:1e3}):this.$notify({title:"提示",message:"请指定开发环境",duration:1e3})}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",["SUCCESS"===t.stateType?a("el-button",{staticClass:"smallBtn view",attrs:{loading:t.loading,type:"primary"},on:{click:function(e){t.buildEnv(t.gitInfo)}}},[t._v(t._s(t.btnName))]):"ABORTED"===t.stateType?a("el-button",{staticClass:"smallBtn view",attrs:{loading:t.loading,type:"warning"},on:{click:function(e){t.buildEnv(t.gitInfo)}}},[t._v(t._s(t.btnName))]):"FAILURE"===t.stateType?a("el-button",{staticClass:"smallBtn view",attrs:{loading:t.loading,type:"danger"},on:{click:function(e){t.buildEnv(t.gitInfo)}}},[t._v(t._s(t.btnName))]):"PENDING"===t.stateType||"STARTED"===t.stateType?a("el-button",{staticClass:"smallBtn view",attrs:{loading:t.loading,type:"info"},on:{click:function(e){t.buildEnv(t.gitInfo)}}},[t._v(t._s(t.btnName))]):a("el-button",{staticClass:"smallBtn view",attrs:{loading:t.loading,type:"primary"},on:{click:function(e){t.buildEnv(t.gitInfo)}}},[t._v(t._s(t.btnName))])],1)},staticRenderFns:[]};var b=a("VU/8")(m,g,!1,function(t){a("sJr7")},"data-v-fec820fa",null).exports,y=a("JRhP");const v=a("7OuW"),w=a("PJh5"),T=a("BAz6");var _={props:{jiraKey:{type:String,default:null}},components:{serverSelect:l.a,configSelect:d.a,targetSelect:u.a,showJenkins:c.a,buildDevJenkins:b,gitState:y.a},data:()=>({devTime:"",jiraStep:"",issuetype:"",dialogVisible:!1,tableData:[],branchName:"",path:"",env:null,updateSignal:null,id:null}),watch:{tableData:{handler:function(){this.$store.commit("changeDevIntelligentRoute",this.tableData)},deep:!0},"$store.state.addBranch":async function(){await this.getBranchList(),this.$store.commit("changeDevIntelligentRoute",this.tableData)},"$store.state.delBranch":async function(){await this.getBranchList(),this.$store.commit("changeDevIntelligentRoute",this.tableData)},"$store.state.update":async function(){await this.getBranchList(),this.$store.commit("changeDevIntelligentRoute",this.tableData)}},async mounted(){await this.getJiraInfo(),await this.getBranchList(),this.$store.commit("changeDevIntelligentRoute",this.tableData),this.id&&clearInterval(this.id),this.id=setInterval(()=>{this.getBranchList(),this.$store.commit("changeDevIntelligentRoute",this.tableData)},3e5)},methods:{updateServer(t){this.tableData.length>0&&(this.tableData[t[0]].defaultServer=t[1]),this.$store.commit("changeDevIntelligentRoute",this.tableData)},updateTarget(t){this.tableData.length>0&&(this.tableData[t[0]].targetHost=t[1],t[2].length,v(20).then(t=>{this.updateSignal=t})),this.$store.commit("changeDevIntelligentRoute",this.tableData)},updateConfig(t){this.tableData[t[0]].config=t[1],v(20).then(t=>{this.updateSignal=t})},openDialog(t,e){this.dialogVisible=!0,this.branchName=t,this.path=e},getBranchList(){T.gitlab.getProjectBranch(this.jiraKey).then(t=>{this.changeJira(t);var e=[];t.map(t=>{T.env.getTestJenkinsJobListByGit(t.path).then(a=>{const r={gitPath:t.path,curSha:t.newValue,server:a,defaultServer:a.length>0?a[0]:"",branch:t.branch,config:"",createTimestamp:t.createTimestamp};e.push(r)})}),this.tableData=e,this.$store.commit("changeDevIntelligentRoute",this.tableData)}).catch(t=>{})},delBranch(){var t=this;T.gitlab.delProjectBranch(t.branchName,t.path).then(e=>{t.dialogVisible=!1,e.state?(this.getBranchList(),t.$notify.success({title:"提示",message:"删除分支成功",duration:1e3}),v(20).then(t=>{this.$store.commit("changeDelBranch",t)})):t.$notify({title:"提示",message:"删除分支失败,请联系管理员...",duration:1e3})}).catch(e=>{t.dialogVisible=!1,t.$notify({title:"提示",message:"删除分支服务异常,请联系管理员...",duration:1e3})})},showState(t){},addBranch(){this.$emit("add")},getJiraInfo(){return new Promise((t,e)=>{axios.get("/api-jiraproxy/api/findIssue?key="+this.jiraKey+"&fields=summary,status,issuetype,customfield_10709").then(e=>{this.jiraStep=e.data.ret.fields.status.name,this.issuetype=e.data.ret.fields.issuetype.name,this.devTime=e.data.ret.fields.customfield_10709,t(this.jiraStep)}).catch(function(t){e(t)})})},async changeJira(t){var e=T.jira.transitions.getTransitionType(this.jiraKey.split("-")[0],this.issuetype);if(t.length>0)if("Template for Buiness Requirement Project v12"==e){var a=(n=new T.jira.transitions_yw_v12).judge(this.jiraStep,"dev");for(var r in a)await n.updateStatus(this.jiraKey,a[r].id);if(this.devTime);else{var s=null;for(var r in t){var i=t[r].createTimestamp;s?w(s).isAfter(w(i))&&(s=i):s=i}var o={fields:{customfield_10709:s.split(" ")[0]+"T"+s.split(" ")[1]+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,o).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Product Requirement Project v12"==e){a=(n=new T.jira.transitions_cp_v12).judge(this.jiraStep,"dev");for(var r in a)await n.updateStatus(this.jiraKey,a[r].id);if(this.devTime);else{s=null;for(var r in t){i=t[r].createTimestamp;s?w(s).isAfter(w(i))&&(s=i):s=i}o={fields:{customfield_10709:s.split(" ")[0]+"T"+s.split(" ")[1]+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,o).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Tech-Project v4.0"==e){var n;a=(n=new T.jira.transitions_tech_v1).judge(this.jiraStep,"dev");for(var r in a)await n.updateStatus(this.jiraKey,a[r].id);if(this.devTime);else{s=null;for(var r in t){i=t[r].createTimestamp;s?w(s).isAfter(w(i))&&(s=i):s=i}o={fields:{customfield_10709:s.split(" ")[0]+"T"+s.split(" ")[1]+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,o).then(t=>{}).catch(t=>{console.log(t)})}}}}},k={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.tableData.length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"stripe"}},[a("el-table-column",{attrs:{label:"",fixed:"fixed",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"danger"},on:{click:function(a){t.openDialog(e.row.branch,e.row.gitPath)}}},[a("i",{staticClass:"el-icon-delete"})])]}}])}),a("el-table-column",{attrs:{label:"操作",fixed:"fixed",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("buildDevJenkins",{attrs:{jiraKey:t.jiraKey,gitInfo:e.row}})]}}])}),a("el-table-column",{attrs:{label:"状态",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("gitState",{attrs:{gitInfo:e.row,signal:t.updateSignal}})]}}])}),a("el-table-column",{attrs:{label:"服务"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("serverSelect",{ref:"select",attrs:{selectData:e},on:{updateServer:t.updateServer}})]}}])}),a("el-table-column",{attrs:{label:"配置"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("configSelect",{attrs:{selectData:e},on:{updateConfig:t.updateConfig}})]}}])}),a("el-table-column",{attrs:{label:"targetHost"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("targetSelect",{attrs:{selectData:e},on:{updateTarget:t.updateTarget}})]}}])}),a("el-table-column",{attrs:{prop:"gitPath",label:"仓库"}}),a("el-table-column",{attrs:{prop:"branch",label:"分支"}}),a("el-table-column",{attrs:{label:"执行过程",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("showJenkins",{attrs:{gitInfo:e.row,deployType:"devDeploy",jiraKey:t.jiraKey}})]}}])})],1):a("el-tag",{attrs:{type:"info"},on:{click:t.addBranch}},[t._v("暂未关联分支")]),t.tableData.length>0?a("p",{staticClass:"tip"},[t._v("*删除分支如需恢复，请在误删的gitlab分支上再次推送代码，即可恢复显示")]):t._e(),a("el-dialog",{attrs:{title:"",visible:t.dialogVisible,width:"50%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-alert",{attrs:{title:"该操作只会删除flow与gitlab分支关联关系，不会删除gitlab中的分支，点击OK进行删除，删除操作不可逆,谨慎操作！！",type:"warning"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"del",on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),a("el-button",{staticClass:"del",attrs:{type:"primary"},on:{click:t.delBranch}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var j=a("VU/8")(_,k,!1,function(t){a("MNqS")},"data-v-a0929c5c",null).exports;const I=a("7OuW");a("BAz6");var S={props:["jiraKey"],components:{addBranch:n,listBranch:j},data:()=>({addSignal:""}),mounted(){},methods:{add(){I(20).then(t=>{this.addSignal=t})}}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("el-card",{attrs:{shadow:"hover"}},[e("el-row",{staticClass:"cfg"},[e("el-col",{attrs:{span:20}},[e("h3",[this._v("关联分支")])]),e("el-col",{attrs:{span:4}},[e("addBranch",{attrs:{jiraKey:this.jiraKey,signal:this.addSignal}})],1)],1),e("el-row",[e("listBranch",{attrs:{jiraKey:this.jiraKey},on:{add:this.add}})],1)],1)],1)},staticRenderFns:[]};var A=a("VU/8")(S,x,!1,function(t){a("EpAy")},"data-v-5d79ae96",null);e.a=A.exports},EpAy:function(t,e){},GNMf:function(t,e){},HCrs:function(t,e,a){"use strict";const r=a("7OuW"),s=a("BAz6");var i={props:["jiraKey"],components:{},data:()=>({envList:[],checked:!0,dialogVisible:!1,form:{},envInfoTable:[],uavInfoTable:[],env:null}),async mounted(){await this.getEnv(),await this.init()},methods:{tableHeaderColor:()=>"color: #000",open:function(){this.form.env=this.$store.state.devEnv,this.envInfoTable=[],this.$store.state.devEnv&&this.getEnvList(!1),this.dialogVisible=!0,this.uavInfoTable=[],"stage"!=this.form.env&&"qa3"!=this.form.env&&"qa5"!=this.form.env||this.getUavList()},init:function(){var t=this;return new Promise(function(e,a){s.datacenter.devEnv.findDevEnv(t.jiraKey).then(function(e){e.data.ret?(t.$store.commit("changeDevEnv",e.data.ret.env),t.env=e.data.ret.env):t.$store.commit("changeDevEnv",null)}).catch(function(e){t.$notify({title:"提示",message:"datacenter服务异常,请联系管理员...",duration:1e3}),a(e)})})},getEnv:function(t){axios.get("/api-lord/rest/api/env/list?loginName="+this.$store.state.user.username).then(e=>{t&&Object.keys(t).length?this.envList=e.data.data.split(",").filter(e=>-1==Object.keys(t).indexOf(e)):this.envList=e.data.data.split(",")}).catch(function(t){})},filterGetEnv:function(){let t=this,e=[];this.$API.filterGetEnv().then(({data:a})=>{Object.keys(a).forEach(function(r){-1!==a[r].jira.indexOf(t.jiraKey)&&e.push(r)}),e.length?this.getEnv():this.getEnv(a)}).catch(t=>{})},updateEnv:function(){s.jira.checkoutEnv(this.form.env,this.jiraKey).then(t=>{if(t.state)if(0==t.status)this.change();else if(1==t.status)this.change();else if(2==t.status){let e=t.epicKey;this.$notify({title:"提示",dangerouslyUseHTMLString:!0,message:`<a href=http://jira.vipkid.com.cn/browse/${e} target="_black">该项目：${e}，正在使用该环境，请线下联系该项目人员或者变更环境</a>`,duration:2e3})}else if(3==t.status){let e="";if(t.jiraList.length>0){t.jiraList.map(t=>(e+="<a href=http://jira.vipkid.com.cn/browse/"+t+' target="_black">项目：'+t+"</a><br>",console.log(e),t+","));e+="<h3>上述项目正在使用该环境，请线下联系相关人员</h3><br>",this.$notify.warning({title:"提示",dangerouslyUseHTMLString:!0,message:e,duration:2e3})}else this.change()}else 4==t.status&&this.change();else console.log("环境校验异常，请联系管理员"),this.$notify.success({title:"提示",message:"指定测试环境失败",duration:1e3})}).catch(t=>{console.log(t),console.log("环境校验失败，请联系管理员"),this.$notify.success({title:"提示",message:"指定测试环境失败",duration:1e3})})},change:function(){this.dialogVisible=!1,s.datacenter.devEnv.findAndUpdateDevEnv(this.jiraKey,this.form.env,"dev").then(t=>{t?(this.init(),this.$store.commit("changeDevEnv",this.form.env),this.$notify.success({title:"提示",message:"指定开发环境成功",duration:1e3}),this.checked&&s.datacenter.testEnv.findAndUpdateTestEnv(this.jiraKey,this.form.env,"test").then(t=>{t?(this.$store.commit("changeTestEnv",this.form.env),this.$notify.success({title:"提示",message:"指定测试环境成功",duration:1e3})):this.$notify({title:"提示",message:"指定测试环境失败,请联系管理员...",duration:1e3})}).catch(t=>{console.log(t),this.$notify({title:"提示",message:"datacenter服务异常,请联系管理员...",duration:1e3})}),r(20).then(t=>{this.$store.commit("changeUpdate",t)})):this.$notify({title:"提示",message:"指定开发环境失败,请联系管理员...",duration:1e3})}).catch(t=>{this.$notify({title:"提示",message:"datacenter服务异常,请联系管理员...",duration:1e3})})},changeEnv:function(){this.getEnvList(),"stage"!=this.form.env&&"qa3"!=this.form.env&&"qa5"!=this.form.env||this.getUavList()},getEnvList:function(t=!0){var e=t?this.form.env:this.$store.state.devEnv;this.envInfoTable=[],s.env.getEnvEngagebyEnv(e,"dev").then(t=>{var a=[];t.map(function(t,e,r){a.push(t.jiraKey)}),axios.get("/api-traceback/api/env/find?env="+e).then(t=>{if("stage"==this.form.env||"qa3"==this.form.env||"qa5"==this.form.env){var e=[];for(var r in this.$store.state.devIntelligentRoute)-1==e.indexOf(this.$store.state.devIntelligentRoute[r].gitPath)&&e.push(this.$store.state.devIntelligentRoute[r].gitPath);for(var r in t.data.ret){if("gitHooks"!=t.data.ret[r].serverName)if(e.indexOf(t.data.ret[r].gitPath)>-1)(s={}).jiraKey=a.indexOf(t.data.ret[r].jiraKey)>=0?t.data.ret[r].jiraKey:"--",s.target_host=t.data.ret[r].target_host,s.server=t.data.ret[r].serverName,s.gitPath=t.data.ret[r].gitPath,s.branch=t.data.ret[r].branch,s.deployTime=t.data.ret[r].updatetimestamp?t.data.ret[r].updatetimestamp:t.data.ret[r].createtimestamp,s.displayName=t.data.ret[r].deployUser,this.envInfoTable.push(s)}}else for(var r in t.data.ret){var s;if("gitHooks"!=t.data.ret[r].serverName)(s={}).jiraKey=a.indexOf(t.data.ret[r].jiraKey)>=0?t.data.ret[r].jiraKey:"--",s.target_host=t.data.ret[r].target_host,s.server=t.data.ret[r].serverName,s.gitPath=t.data.ret[r].gitPath,s.branch=t.data.ret[r].branch,s.deployTime=t.data.ret[r].updatetimestamp?t.data.ret[r].updatetimestamp:t.data.ret[r].createtimestamp,s.displayName=t.data.ret[r].deployUser,this.envInfoTable.push(s)}}).catch(t=>{})}).catch(t=>{})},getUavList:function(){this.uavInfoTable=[];var t=[];for(var e in this.$store.state.devIntelligentRoute)this.$store.state.devIntelligentRoute[e].defaultServer&&t.push(this.$store.state.devIntelligentRoute[e].defaultServer);var a={envName:this.form.env,serviceNameList:t};axios.post("/api-lord/rest/api/app/recommend/getTargetHost",a,{auth:{username:"ranger",password:"dUNUjOF1ebWyMmJmfYZB"}}).then(t=>{for(var e in t.data.data){var a={};a.businessName=t.data.data[e].businessName,a.uavOne=t.data.data[e].targetHostList[0],a.uavTwo=t.data.data[e].targetHostList[1],a.uavThree=t.data.data[e].targetHostList[2],this.uavInfoTable.push(a)}}).catch(t=>{console.log(t)})},buildJob:function(){}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.env?t._e():a("el-card",{attrs:{shadow:"hover"}},[a("el-row",{staticClass:"cfg"},[a("el-col",{attrs:{span:20}},[a("h3",[t._v("开发环境")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.open}},[t._v("选择")])],1)],1)],1),t.env?a("el-card",{attrs:{shadow:"hover"}},[a("el-row",{staticClass:"cfg"},[a("el-col",{attrs:{span:20}},[a("h3",[t._v("开发环境"),a("el-tag",{staticClass:"envTag",attrs:{type:"info"}},[t._v(t._s(t.$store.state.devEnv))])],1),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.open}},[t._v("更换")])],1)],1)],1):t._e(),a("el-dialog",{attrs:{title:"指定开发环境",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{attrs:{model:t.form}},[a("el-form-item",{attrs:{label:"请选则关联环境"}},[a("el-select",{attrs:{placeholder:"请选则关联环境"},on:{change:t.changeEnv},model:{value:t.form.env,callback:function(e){t.$set(t.form,"env",e)},expression:"form.env"}},t._l(t.envList,function(t){return a("el-option",{key:t,attrs:{value:t,label:t}})})),a("el-checkbox",{staticClass:"testEnv",attrs:{border:"border"},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}},[t._v("同时指定测试环境")])],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"stage"===t.form.env||"qa3"===t.form.env||"qa5"===t.form.env,expression:"form.env === 'stage' || form.env === 'qa3' || form.env === 'qa5'"}],staticClass:"cfg"},[a("el-col",{attrs:{span:12}},[a("h3",[t._v("无人机推荐")])]),a("el-col",{attrs:{span:12}}),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.uavInfoTable,stripe:"stripe","max-height":"500",border:"border",size:"small","header-cell-style":t.tableHeaderColor}},[a("el-table-column",{attrs:{prop:"businessName",label:"业务端",align:"center"}}),a("el-table-column",{attrs:{prop:"uavOne",label:"推荐1",align:"center"}}),a("el-table-column",{attrs:{prop:"uavTwo",label:"推荐2",align:"center"}}),a("el-table-column",{attrs:{prop:"uavThree",label:"推荐3",align:"center"}})],1)],1),a("el-row",{staticClass:"cfg"},[a("el-col",{attrs:{span:12}},[a("h3",[t._v("环境服务详情")])]),a("el-col",{attrs:{span:12}},[a("p")]),a("el-alert",{attrs:{title:"",type:"warning",closable:!1}},[t._v("如需同步数据库,请联系QA负责人")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.envInfoTable,stripe:"stripe","max-height":"500",size:"small","header-cell-style":t.tableHeaderColor}},[a("el-table-column",{attrs:{label:"部署成最新master",width:"120px",fixed:"fixed",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{disabled:"disabled",type:"primary"},on:{click:t.buildJob}},[t._v("部署")])]}}])}),a("el-table-column",{attrs:{prop:"jiraKey",label:"项目",align:"center"}}),a("el-table-column",{attrs:{prop:"target_host",label:"targetHost",width:"90px",align:"center"}}),a("el-table-column",{attrs:{prop:"server",label:"服务名",align:"center"}}),a("el-table-column",{attrs:{prop:"gitPath",label:"仓库",align:"center"}}),a("el-table-column",{attrs:{prop:"branch",label:"分支",align:"center"}}),a("el-table-column",{attrs:{prop:"deployTime",label:"部署时间",align:"center"}}),a("el-table-column",{attrs:{prop:"displayName",label:"部署人",align:"center"}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updateEnv}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(i,o,!1,function(t){a("boyU")},"data-v-a6a9b238",null);e.a=n.exports},HGto:function(t,e,a){"use strict";var r=a("NZZJ"),s=a("uMhb"),i=a("3Ny8"),o=a("hkav"),n=a("X9sw");const l=a("T5Ki"),d=a("ADll"),u=a("BAz6"),c=a("7OuW"),p=a("PJh5"),h=[{name:"代码review人",value:[]},{name:"日志",value:"正确携带对应功能的统计参数",label1:"通过",label2:"不通过",status:""},{name:"日志",value:"无功能性错误日志",label1:"通过",label2:"不通过",status:""},{name:"配置",value:"对用户开放的功能所涉及的所有配置，不能配成线下地址",label1:"通过",label2:"不通过",status:""},{name:"配置",value:"所有请求后端的配置，不能配成线下地址",label1:"通过",label2:"不通过",status:""}],f=[{name:"遗留历史问题",value:""}],m=[{name:"测试结论",value:"",label1:"测试通过",label2:"测试不通过"}];var g={props:["jiraKey","report"],components:{l_getEmail:r.a,l_uploadFile:s.a,l_compatible:i.a,l_listTestBranch:o.a,l_gitTagInfo:n.a},data(){return{data:{jiraKey:this.jiraKey,type:"expressTestReport",sendUserMail:"",sendUserName:"",emailTo:[],summary:"",env:null,testResult:m,historyQuestion:f,codeReview:h,confirmCase:[],manualTest:[],gitInfo:[],bugList:[],uploadFiles:[],isSubmitAll:!1},jiraStep:null,showUploadlist:[],project:{},rules:{emailTo:[{type:"array",required:!0,message:"请输入收件人",trigger:"blur"}],value:[{required:!0,message:"请填写/选择",trigger:"change"}],codeReview:[{required:!0,message:"请填写代码review负责人",trigger:"change"}],status:[{required:!0,message:"请选择结论",trigger:"change"}]}}},computed:{projectInfo(){return[{name:"项目名称",value:this.data.summary},{name:"测试环境",value:this.data.env}]}},watch:{report:{handler:async function(){""!==this.report?(this.data.jiraKey=this.report.jiraKey,this.data.summary=this.report.summary,this.data.emailTo=this.report.emailTo,this.data.testResult=this.report.testResult,this.data.historyQuestion=this.report.historyQuestion,this.data.codeReview=this.report.codeReview):""==this.report&&(this.data.jiraKey=this.jiraKey,u.jira.getSummary(this.jiraKey).then(t=>{this.data.summary=this.jiraKey+":"+t.fields.summary}),u.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t})),await this.getConfirmCase(),await this.getManualTest(),await this.getBugList()},deep:!0},"$store.state.expressManualCaseNotice":async function(){await this.getManualTest()},"$store.state.expressConfirmNotice":async function(){await this.getConfirmCase()}},async mounted(){this.data.sendUserMail=this.$store.state.user.mail,this.data.sendUserName=this.$store.state.user.displayName,""!=this.report?(this.data.jiraKey=this.report.jiraKey,this.data.summary=this.report.summary,this.data.emailTo=this.report.emailTo,this.data.historyQuestion=this.report.historyQuestion,this.data.codeReview=this.report.codeReview):""==this.report&&(this.data.jiraKey=this.jiraKey,u.jira.getSummary(this.jiraKey).then(t=>{this.data.summary=this.jiraKey+":"+t.fields.summary}),u.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t})),this.data.testResult[0].value="测试通过",await this.getDevEnv(),await this.getConfirmCase(),await this.getManualTest(),await this.getBugList()},methods:{preventStop(t){t.preventDefault()},getGitInfo(t){this.data.gitInfo=t},emailCreateContent(){var t=this,e=l.selfTestTitleToHtml(this.data)+l.testInfoHtml(this.data)+l.gitTagInfoToHtml(this.data)+l.codeReviewToHtml(this.data);return d.expressProcessMap(this.jiraKey.split("-")[0]).executionSteps.forEach(function(a){"manualCaseConfirmStep_express"===a?e+=l.manualTestToHtml(t.data):"qaConfirmStep"===a&&(e+=l.selfTestConfirmCaseToHtml(t.data))}),e+=l.bugListToHtml(this.data)+l.fileListToHtml(this.data)},send(){var t=this,e=0;if(this.data.gitInfo.forEach(function(t){t.submit&&(e+=1)}),0==this.data.gitInfo.length||this.data.gitInfo.length>0&&e<=0)t.$notify.error({title:"提示",message:"本次测试git信息不能为空,至少勾选一项"});else{var a=!0;if(Object.keys(this.$refs).forEach(function(e){console.log(e),t.$refs[e]&&"gitTagValidate"!==e&&t.$refs[e].validate(t=>{t||(a=!1)})}),a&&this.$refs.gitTagValidate.submitForm()){var r=[];this.data.emailTo.forEach(function(t){r.push(t+"@vipkid.com.cn")}),r.push(this.$store.state.user.mail);var s="【自测报告】"+this.data.summary+"--项目自测报告  发送人:"+this.$store.state.user.displayName,i=this.emailCreateContent();u.report.insertOne(this.data).then(e=>{var a='<p><font color="black" size="5">报告编号：'+e.data.id+"</font></p>";i=a+i;var o={receiver:r.join(",")+",zhangpengyang@vipkid.com.cn,xielin1@vipkid.com.cn,mengdeliang@vipkid.com.cn,zhuxingjun@vipkid.com.cn,changlili@vipkid.com.cn",title:s,content:i};if(e.data.state){u.mailsender.send(o).then(e=>{e.data.state&&t.$notify.success({title:"提示",message:"发送自测报告成功",duration:2e3})});var n={sendTime:e.data.sendTime,reportID:e.data.id,sendUserName:this.$store.state.user.displayName,gitInfo:this.data.gitInfo,testResult:this.data.testResult[0].value};u.datacenter.testReport.findAndUpdateTestReport(t.jiraKey,n,m).then(t=>{if(t.data.state){c(20).then(t=>{this.$store.commit("changeExpressTestReportUpdate",t)});var e=this.$store.state.user.displayName+" 发送了自测报告";u.jira.addComment(this.jiraKey,e),u.datacenter.step.findAndUpdateStep(this.jiraKey,"测报"),this.$emit("update"),this.reportTestJira()}}),this.$emit("closeDialog")}})}else console.log("valid error")}},arraySpanMethod({row:t,column:e,rowIndex:a,columnIndex:r}){if(0==a&&1==r)return[1,2]},getTableHeaderCellStyle:()=>({background:"#f85415",color:"#FFFFFF"}),getTable2HeaderCellStyle:()=>({color:" #CC3300",background:"#dedede"}),getTable3HeaderCellStyle:()=>({color:" #000000",background:"#dedede"}),getEmailList(t){this.data.emailTo=t},getCodeReview(t){this.data.codeReview[0].value=t},getJiraInfo:async function(){return new Promise((t,e)=>{axios.get("/api-jiraproxy/api/findIssue?key="+this.jiraKey+"&fields=summary,status,issuetype").then(e=>{this.jiraStep=e.data.ret.fields.status.name,this.issuetype=e.data.ret.fields.issuetype.name,t(this.jiraStep)}).catch(function(t){e(t)})})},getDevEnv(){u.datacenter.devEnv.findDevEnv(this.jiraKey).then(t=>{t.data.state&&(null!=t.data.ret?this.data.env=t.data.ret.env:this.data.env="暂未指定开发环境,请指定！")})},getConfirmCase(){u.datacenter.confirmCase.findConfirmCase(this.jiraKey).then(t=>{t.data.state&&(t.data.ret?(this.data.confirmCase=[],this.data.confirmCase.push(t.data.ret)):this.data.confirmCase=null)})},getManualTest(){u.datacenter.manualTest.findManualTest(this.jiraKey).then(t=>{t.data.state&&(t.data.ret?(this.data.manualTest=[],this.data.manualTest.push(t.data.ret)):this.data.manualTest=null)})},getBugList(){var t=this;t.data.bugList=[],u.jira.getProjectBugList(this.jiraKey,"TODO").then(e=>{e.map(function(e){t.data.bugList.push({jiraID:e.key,summary:e.fields.summary,priority:e.fields.priority.name,status:"TODO",severity:e.fields.customfield_10241.value,rd:e.fields.customfield_10639?e.fields.customfield_10639.displayName:"",qa:e.fields.customfield_10640.displayName,submit:!0})})}),u.jira.getProjectBugList(this.jiraKey,"待验证").then(e=>{e.map(function(e){t.data.bugList.push({jiraID:e.key,summary:e.fields.summary,priority:e.fields.priority.name,status:"待验证",severity:e.fields.customfield_10241.value,rd:e.fields.customfield_10639?e.fields.customfield_10639.displayName:"",qa:e.fields.customfield_10640.displayName,submit:!0})})}),u.jira.getProjectBugList(this.jiraKey,"待确认").then(e=>{e.map(function(e){t.data.bugList.push({jiraID:e.key,summary:e.fields.summary,priority:e.fields.priority.name,status:"待确认",severity:e.fields.customfield_10241.value,rd:e.fields.customfield_10639?e.fields.customfield_10639.displayName:"",qa:e.fields.customfield_10640.displayName,submit:!0})})})},cancle(){this.$emit("closeDialog")},uploadFiles:function(t){var e=[];for(var a in t){var r={};r.name=t[a].name,r.url="http://10.16.16.3/"+this.jiraKey+"/report/"+t[a].name,e.push(r)}this.data.uploadFiles=e},async reportTestJira(){await this.getJiraInfo(),u.timestamp.updateTime(this.jiraKey,"testReport");var t=u.jira.transitions.getTransitionType(this.jiraKey.split("-")[0],this.issuetype);if("Template for Project v11"==t){var e=(s=new u.jira.transitions_v11).judge(this.jiraStep,"testReport");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);var r={fields:{customfield_10712:p().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}else if("Template for Tech-Project v4.0"==t){e=(s=new u.jira.transitions_tech_v1).judge(this.jiraStep,"testReport");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);r={fields:{customfield_10712:p().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}else if("Template for Buiness Requirement Project v12"==t||"Template for Buiness Requirement Project v12.1"==t){e=(s=new u.jira.transitions_yw_v12).judge(this.jiraStep,"testReport");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);r={fields:{customfield_10712:p().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}else if("Template for Product Requirement Project v12"==t||"Template for Product Requirement Project v12.1"==t){var s;e=(s=new u.jira.transitions_cp_v12).judge(this.jiraStep,"testReport");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);r={fields:{customfield_10712:p().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"data",staticClass:"demo-ruleForm",attrs:{model:t.data,rules:t.rules,"label-width":"130px","label-position":"right"},nativeOn:{submit:function(e){return t.preventStop(e)}}},[a("el-form-item",{attrs:{label:"收件人",prop:"emailTo"}},[a("l_getEmail",{attrs:{emailTo:t.data.emailTo,getEmailList:t.getEmailList}})],1)],1),a("el-table",{attrs:{data:[""],border:"border",spanMethod:t.arraySpanMethod,"header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"测试综述"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{attrs:{data:t.projectInfo,"show-header":!1,spanMethod:t.arraySpanMethod,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{prop:"name",width:"200px"}}),a("el-table-column",{attrs:{prop:"value"}})],1),a("el-table",{attrs:{data:t.data.testResult,border:"border","show-header":!1,"header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{prop:"name",width:"200px"}}),a("el-table-column",{attrs:{prop:"value"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form1"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"value"}},[a("el-radio-group",{model:{value:e.row.value,callback:function(a){t.$set(e.row,"value",a)},expression:"scope.row.value"}},[a("el-radio",{attrs:{label:e.row.label1,size:"medium"}},[t._v(t._s(e.row.label1))]),a("el-radio",{attrs:{label:e.row.label2,size:"medium"}},[t._v(t._s(e.row.label2))])],1)],1)],1)]}}])})],1),a("el-table",{attrs:{data:t.data.historyQuestion,border:"border","show-header":!1}},[a("el-table-column",{attrs:{prop:"name",width:"200px"}}),a("el-table-column",{attrs:{prop:"value"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form2"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"value"}},[a("el-input",{attrs:{type:"textarea",placeholder:e.row.value},model:{value:e.row.value,callback:function(a){t.$set(e.row,"value",a)},expression:"scope.row.value"}})],1)],1)]}}])})],1)]}}])})],1),a("el-table",{attrs:{data:[""],border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"本次测试git信息(*tag及serverName为上线使用,务必准确)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("l_gitTagInfo",{ref:"gitTagValidate",attrs:{jiraKey:t.jiraKey,oninput:t.getGitInfo}})]}}])})],1),a("el-table",{attrs:{data:[""],border:"border",spanMethod:t.arraySpanMethod,"header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"代码审查"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{attrs:{data:t.data.codeReview,"show-header":!1,spanMethod:t.arraySpanMethod,border:"border"}},[a("el-table-column",{attrs:{prop:"name"}}),a("el-table-column",{attrs:{prop:"value"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.$index?a("l_getEmail",{attrs:{emailTo:t.data.codeReview[0].value,getEmailList:t.getCodeReview}}):a("div",[t._v(t._s(e.row.value))])]}}])}),a("el-table-column",{attrs:{prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!==e.$index?a("el-form",{ref:"form3"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"status"}},[a("el-radio-group",{model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}},[a("el-radio",{attrs:{label:e.row.label1,size:"medium"}},[t._v(t._s(e.row.label1))]),a("el-radio",{attrs:{label:e.row.label2,size:"medium"}},[t._v(t._s(e.row.label2))])],1)],1)],1):t._e()]}}])})],1)]}}])})],1),a("el-table",{attrs:{data:[""],spanMethod:t.arraySpanMethod,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"人工测试结果"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{attrs:{data:t.data.manualTest,border:"border","header-cell-style":t.getTable2HeaderCellStyle}},[a("el-table-column",{attrs:{prop:"username",label:"测试人"}}),a("el-table-column",{attrs:{prop:"updateTimestamp",label:"测试时间"}}),a("el-table-column",{attrs:{prop:"status",label:"测试结果"}})],1)]}}])})],1),a("el-table",{attrs:{data:[""],spanMethod:t.arraySpanMethod,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"验收结果"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{attrs:{data:t.data.confirmCase,border:"border","header-cell-style":t.getTable2HeaderCellStyle}},[a("el-table-column",{attrs:{prop:"username",label:"验收人"}}),a("el-table-column",{attrs:{prop:"updateTimestamp",label:"验收时间"}}),a("el-table-column",{attrs:{prop:"status",label:"验收结果"}})],1)]}}])})],1),a("el-table",{attrs:{data:[""],spanMethod:t.arraySpanMethod,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"未修复Bug列表"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-table",{attrs:{data:t.data.bugList,border:"border","header-cell-style":t.getTable2HeaderCellStyle}},[a("el-table-column",{attrs:{label:"#",type:"index"}}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"qa",label:"提测人"}}),a("el-table-column",{attrs:{prop:"rd",label:"修复人"}}),a("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),a("el-table-column",{attrs:{prop:"severity",label:"严重程度"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}})],1)]}}])})],1),a("el-table",{attrs:{data:[""],spanMethod:t.arraySpanMethod,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"附件"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("l_uploadFile",{attrs:{jiraKey:t.jiraKey,fileType:"report",showUploadlistInfo:t.showUploadlist,oninput:t.uploadFiles}})]}}])})],1),a("div",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.send}},[t._v("发送测试报告")]),a("el-button",{attrs:{size:"small"},on:{click:t.cancle}},[t._v("取消发送")])],1)],1)},staticRenderFns:[]};var y=a("VU/8")(g,b,!1,function(t){a("gwzj")},"data-v-3ae0e2f2",null).exports,v=a("e/K+");const w=a("BAz6");var T={props:["jiraKey"],components:{l_getEmail:r.a,showForm:v.a,sendForm:y},data:()=>({type:"expressTestReport",form:{},tableData:[],dialogVisible:!1,sendFormVisible:!1,showFormVisible:!1,isAreadySend:!1,report:[],status:!1}),watch:{"$store.state.expressTestReportUpdate":async function(){await this.update()}},async mounted(){this.tableData=[],await this.initHistoryReport()},methods:{initHistoryReport(){w.report.getReport(this.jiraKey,this.type).then(t=>{t.data.ret.length?(this.tableData=[],this.tableData=t.data.ret,this.isAreadySend=!0):this.isAreadySend=!1})},submit(){this.report="",this.sendFormVisible=!0,this.showFormVisible=!1},link(t,e){this.$router.push({name:t,query:{jiraKey:e}})},redo(t,e){this.report={},this.report=t,this.sendFormVisible=!0},review(t,e){this.report={},this.report=t,this.showFormVisible=!0},async update(){this.isAreadySend=!0,await this.initHistoryReport()}}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.isAreadySend?a("el-card",{attrs:{shadow:"hover"}},[a("el-row",{staticClass:"cfg"},[a("h3",[t._v("项目测试报告")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(e){t.sendFormVisible=!0}}},[t._v("发送自测报告")])],1),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"stripe","max-height":"300"}},[a("el-table-column",{attrs:{label:"操作",fixed:"fixed",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(a){t.redo(e.row,e.row.index)}}},[t._v("复用")])]}}])}),a("el-table-column",{attrs:{label:"查看",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(a){t.review(e.row,e.row.index)}}},[t._v("查看")])]}}])}),a("el-table-column",{attrs:{prop:"sendTime",label:"报告时间"}}),a("el-table-column",{attrs:{prop:"sendUserName",label:"报告人"}})],1)],1)],1):t._e(),t.isAreadySend?t._e():a("el-card",{attrs:{shadow:"hover"}},[a("h3",[t._v("测试报告")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(e){t.sendFormVisible=!0}}},[t._v(" 发送自测报告")])],1),a("el-dialog",{attrs:{title:"发送自测报告",visible:t.sendFormVisible,center:"center",width:"1000px"},on:{"update:visible":function(e){t.sendFormVisible=e}}},[a("sendForm",{attrs:{jiraKey:t.jiraKey,report:t.report},on:{update:t.update,closeDialog:function(e){t.sendFormVisible=!1}}})],1),a("el-dialog",{attrs:{title:"历史测试报告",visible:t.showFormVisible,center:"center",width:"1000px"},on:{"update:visible":function(e){t.showFormVisible=e}}},[a("showForm",{attrs:{jiraKey:t.jiraKey,report:t.report},on:{closeDialog:function(e){t.showFormVisible=!1}}})],1)],1)},staticRenderFns:[]};var k=a("VU/8")(T,_,!1,function(t){a("+YqC")},"data-v-946b6eea",null);e.a=k.exports},KJD0:function(t,e){},MNqS:function(t,e){},N0fl:function(t,e){},NV47:function(t,e,a){var r=a("jF+B");if(r.alloc)var s=r.alloc(512),i=r.alloc(256);else s=new r(512),i=new r(256);!function(){for(var t=1,e=0;e<255;e++)s[e]=t,i[t]=e,256&(t<<=1)&&(t^=285);for(e=255;e<512;e++)s[e]=s[e-255]}(),e.log=function(t){if(t<1)throw new Error("log("+t+")");return i[t]},e.exp=function(t){return s[t]},e.mul=function(t,e){return 0===t||0===e?0:s[i[t]+i[e]]}},"NY/E":function(t,e){var a="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+",r="(?:(?![A-Z0-9 $%*+\\-./:]|"+(a=a.replace(/u/g,"\\u"))+")(?:.|[\r\n]))+";e.KANJI=new RegExp(a,"g"),e.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),e.BYTE=new RegExp(r,"g"),e.NUMERIC=new RegExp("[0-9]+","g"),e.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");var s=new RegExp("^"+a+"$"),i=new RegExp("^[0-9]+$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");e.testKanji=function(t){return s.test(t)},e.testNumeric=function(t){return i.test(t)},e.testAlphanumeric=function(t){return o.test(t)}},PnjJ:function(t,e){},RO0P:function(t,e,a){var r=a("uF9H"),s=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function i(t){this.mode=r.ALPHANUMERIC,this.data=t}i.getBitsLength=function(t){return 11*Math.floor(t/2)+t%2*6},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(t){var e;for(e=0;e+2<=this.data.length;e+=2){var a=45*s.indexOf(this.data[e]);a+=s.indexOf(this.data[e+1]),t.put(a,11)}this.data.length%2&&t.put(s.indexOf(this.data[e]),6)},t.exports=i},RY9c:function(t,e,a){var r=a("jF+B");function s(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new r(t*t),this.data.fill(0),this.reservedBit=new r(t*t),this.reservedBit.fill(0)}s.prototype.set=function(t,e,a,r){var s=t*this.size+e;this.data[s]=a,r&&(this.reservedBit[s]=!0)},s.prototype.get=function(t,e){return this.data[t*this.size+e]},s.prototype.xor=function(t,e,a){this.data[t*this.size+e]^=a},s.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]},t.exports=s},RoM9:function(t,e){},Sd0T:function(t,e,a){var r=a("utyv"),s=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],i=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];e.getBlocksCount=function(t,e){switch(e){case r.L:return s[4*(t-1)+0];case r.M:return s[4*(t-1)+1];case r.Q:return s[4*(t-1)+2];case r.H:return s[4*(t-1)+3];default:return}},e.getTotalCodewordsCount=function(t,e){switch(e){case r.L:return i[4*(t-1)+0];case r.M:return i[4*(t-1)+1];case r.Q:return i[4*(t-1)+2];case r.H:return i[4*(t-1)+3];default:return}}},Ub4f:function(t,e){},VjMH:function(t,e){},WEzc:function(t,e,a){var r=a("jF+B"),s=a("oLzS"),i=a("utyv"),o=a("DEuz"),n=a("RY9c"),l=a("9jEu"),d=a("YamF"),u=a("ljsv"),c=a("Sd0T"),p=a("wBZN"),h=a("1Y2G"),f=a("xR/K"),m=a("uF9H"),g=a("nyx9"),b=a("Dsid");function y(t,e,a){var r,s,i=t.size,o=f.getEncodedBits(e,a);for(r=0;r<15;r++)s=1==(o>>r&1),r<6?t.set(r,8,s,!0):r<8?t.set(r+1,8,s,!0):t.set(i-15+r,8,s,!0),r<8?t.set(8,i-r-1,s,!0):r<9?t.set(8,15-r-1+1,s,!0):t.set(8,15-r-1,s,!0);t.set(i-8,8,1,!0)}function v(t,e,a){var i=new o;a.forEach(function(e){i.put(e.mode.bit,4),i.put(e.getLength(),m.getCharCountIndicator(e.mode,t)),e.write(i)});var n=8*(s.getSymbolTotalCodewords(t)-c.getTotalCodewordsCount(t,e));for(i.getLengthInBits()+4<=n&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(0);for(var l=(n-i.getLengthInBits())/8,d=0;d<l;d++)i.put(d%2?17:236,8);return function(t,e,a){for(var i=s.getSymbolTotalCodewords(e),o=c.getTotalCodewordsCount(e,a),n=i-o,l=c.getBlocksCount(e,a),d=l-i%l,u=Math.floor(i/l),h=Math.floor(n/l),f=h+1,m=u-h,g=new p(m),b=0,y=new Array(l),v=new Array(l),w=0,T=new r(t.buffer),_=0;_<l;_++){var k=_<d?h:f;y[_]=T.slice(b,b+k),v[_]=g.encode(y[_]),b+=k,w=Math.max(w,k)}var j,I,S=new r(i),x=0;for(j=0;j<w;j++)for(I=0;I<l;I++)j<y[I].length&&(S[x++]=y[I][j]);for(j=0;j<m;j++)for(I=0;I<l;I++)S[x++]=v[I][j];return S}(i,t,e)}function w(t,e,a,r){var i;if(b(t))i=g.fromArray(t);else{if("string"!=typeof t)throw new Error("Invalid data");var o=e;if(!o){var c=g.rawSplit(t);o=h.getBestVersionForData(c,a)}i=g.fromString(t,o||40)}var p=h.getBestVersionForData(i,a);if(!p)throw new Error("The amount of data is too big to be stored in a QR Code");if(e){if(e<p)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+p+".\n")}else e=p;var f=v(e,a,i),m=s.getSymbolSize(e),w=new n(m);return function(t,e){for(var a=t.size,r=d.getPositions(e),s=0;s<r.length;s++)for(var i=r[s][0],o=r[s][1],n=-1;n<=7;n++)if(!(i+n<=-1||a<=i+n))for(var l=-1;l<=7;l++)o+l<=-1||a<=o+l||(n>=0&&n<=6&&(0===l||6===l)||l>=0&&l<=6&&(0===n||6===n)||n>=2&&n<=4&&l>=2&&l<=4?t.set(i+n,o+l,!0,!0):t.set(i+n,o+l,!1,!0))}(w,e),function(t){for(var e=t.size,a=8;a<e-8;a++){var r=a%2==0;t.set(a,6,r,!0),t.set(6,a,r,!0)}}(w),function(t,e){for(var a=l.getPositions(e),r=0;r<a.length;r++)for(var s=a[r][0],i=a[r][1],o=-2;o<=2;o++)for(var n=-2;n<=2;n++)-2===o||2===o||-2===n||2===n||0===o&&0===n?t.set(s+o,i+n,!0,!0):t.set(s+o,i+n,!1,!0)}(w,e),y(w,a,0),e>=7&&function(t,e){for(var a,r,s,i=t.size,o=h.getEncodedBits(e),n=0;n<18;n++)a=Math.floor(n/3),r=n%3+i-8-3,s=1==(o>>n&1),t.set(a,r,s,!0),t.set(r,a,s,!0)}(w,e),function(t,e){for(var a=t.size,r=-1,s=a-1,i=7,o=0,n=a-1;n>0;n-=2)for(6===n&&n--;;){for(var l=0;l<2;l++)if(!t.isReserved(s,n-l)){var d=!1;o<e.length&&(d=1==(e[o]>>>i&1)),t.set(s,n-l,d),-1==--i&&(o++,i=7)}if((s+=r)<0||a<=s){s-=r,r=-r;break}}}(w,f),isNaN(r)&&(r=u.getBestMask(w,y.bind(null,w,a))),u.applyMask(r,w),y(w,a,r),{modules:w,version:e,errorCorrectionLevel:a,maskPattern:r,segments:i}}e.create=function(t,e){if(void 0===t||""===t)throw new Error("No input text");var a,r,o=i.M;return void 0!==e&&(o=i.from(e.errorCorrectionLevel,i.M),a=h.from(e.version),r=u.from(e.maskPattern),e.toSJISFunc&&s.setToSJISFunction(e.toSJISFunc)),w(t,a,o,r)}},X0RI:function(t,e,a){var r=a("jF+B"),s=a("NV47");e.mul=function(t,e){var a=new r(t.length+e.length-1);a.fill(0);for(var i=0;i<t.length;i++)for(var o=0;o<e.length;o++)a[i+o]^=s.mul(t[i],e[o]);return a},e.mod=function(t,e){for(var a=new r(t);a.length-e.length>=0;){for(var i=a[0],o=0;o<e.length;o++)a[o]^=s.mul(e[o],i);for(var n=0;n<a.length&&0===a[n];)n++;a=a.slice(n)}return a},e.generateECPolynomial=function(t){for(var a=new r([1]),i=0;i<t;i++)a=e.mul(a,[1,s.exp(i)]);return a}},YamF:function(t,e,a){var r=a("oLzS").getSymbolSize;e.getPositions=function(t){var e=r(t);return[[0,0],[e-7,0],[0,e-7]]}},"b2+w":function(t,e,a){"use strict";var r={single_source_shortest_paths:function(t,e,a){var s={},i={};i[e]=0;var o,n,l,d,u,c,p,h=r.PriorityQueue.make();for(h.push(e,0);!h.empty();)for(l in n=(o=h.pop()).value,d=o.cost,u=t[n]||{})u.hasOwnProperty(l)&&(c=d+u[l],p=i[l],(void 0===i[l]||p>c)&&(i[l]=c,h.push(l,c),s[l]=n));if(void 0!==a&&void 0===i[a]){var f=["Could not find a path from ",e," to ",a,"."].join("");throw new Error(f)}return s},extract_shortest_path_from_predecessor_list:function(t,e){for(var a=[],r=e;r;)a.push(r),t[r],r=t[r];return a.reverse(),a},find_path:function(t,e,a){var s=r.single_source_shortest_paths(t,e,a);return r.extract_shortest_path_from_predecessor_list(s,a)},PriorityQueue:{make:function(t){var e,a=r.PriorityQueue,s={};for(e in t=t||{},a)a.hasOwnProperty(e)&&(s[e]=a[e]);return s.queue=[],s.sorter=t.sorter||a.default_sorter,s},default_sorter:function(t,e){return t.cost-e.cost},push:function(t,e){var a={value:t,cost:e};this.queue.push(a),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};t.exports=r},boyU:function(t,e){},cJP9:function(t,e){t.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},gwzj:function(t,e){},izB8:function(t,e){},"jF+B":function(t,e,a){"use strict";var r=a("Dsid");i.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}();var s=i.TYPED_ARRAY_SUPPORT?2147483647:1073741823;function i(t,e,a){return i.TYPED_ARRAY_SUPPORT||this instanceof i?"number"==typeof t?l(this,t):function(t,e,a,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer)return function(t,e,a,r){if(a<0||e.byteLength<a)throw new RangeError("'offset' is out of bounds");if(e.byteLength<a+(r||0))throw new RangeError("'length' is out of bounds");var s;s=void 0===a&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,a):new Uint8Array(e,a,r);i.TYPED_ARRAY_SUPPORT?s.__proto__=i.prototype:s=d(t,s);return s}(t,e,a,r);if("string"==typeof e)return function(t,e){var a=0|c(e),r=n(t,a),s=r.write(e);s!==a&&(r=r.slice(0,s));return r}(t,e);return function(t,e){if(i.isBuffer(e)){var a=0|o(e.length),r=n(t,a);return 0===r.length?r:(e.copy(r,0,0,a),r)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(s=e.length)!=s?n(t,0):d(t,e);if("Buffer"===e.type&&Array.isArray(e.data))return d(t,e.data)}var s;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}(this,t,e,a):new i(t,e,a)}function o(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function n(t,e){var a;return i.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(e)).__proto__=i.prototype:(null===(a=t)&&(a=new i(e)),a.length=e),a}function l(t,e){var a=n(t,e<0?0:0|o(e));if(!i.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)a[r]=0;return a}function d(t,e){for(var a=e.length<0?0:0|o(e.length),r=n(t,a),s=0;s<a;s+=1)r[s]=255&e[s];return r}function u(t,e){var a;e=e||1/0;for(var r=t.length,s=null,i=[],o=0;o<r;++o){if((a=t.charCodeAt(o))>55295&&a<57344){if(!s){if(a>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&i.push(239,191,189);continue}s=a;continue}if(a<56320){(e-=3)>-1&&i.push(239,191,189),s=a;continue}a=65536+(s-55296<<10|a-56320)}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,a<128){if((e-=1)<0)break;i.push(a)}else if(a<2048){if((e-=2)<0)break;i.push(a>>6|192,63&a|128)}else if(a<65536){if((e-=3)<0)break;i.push(a>>12|224,a>>6&63|128,63&a|128)}else{if(!(a<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}}return i}function c(t){return i.isBuffer(t)?t.length:"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)?t.byteLength:("string"!=typeof t&&(t=""+t),0===t.length?0:u(t).length)}i.TYPED_ARRAY_SUPPORT&&(i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1})),i.prototype.write=function(t,e,a){void 0===e?(a=this.length,e=0):void 0===a&&"string"==typeof e?(a=this.length,e=0):isFinite(e)&&(e|=0,isFinite(a)?a|=0:a=void 0);var r=this.length-e;if((void 0===a||a>r)&&(a=r),t.length>0&&(a<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");return function(t,e,a,r){return function(t,e,a,r){for(var s=0;s<r&&!(s+a>=e.length||s>=t.length);++s)e[s+a]=t[s];return s}(u(e,t.length-a),t,a,r)}(this,t,e,a)},i.prototype.slice=function(t,e){var a,r=this.length;if(t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),i.TYPED_ARRAY_SUPPORT)(a=this.subarray(t,e)).__proto__=i.prototype;else{var s=e-t;a=new i(s,void 0);for(var o=0;o<s;++o)a[o]=this[o+t]}return a},i.prototype.copy=function(t,e,a,r){if(a||(a=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<a&&(r=a),r===a)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-a&&(r=t.length-e+a);var s,o=r-a;if(this===t&&a<e&&e<r)for(s=o-1;s>=0;--s)t[s+e]=this[s+a];else if(o<1e3||!i.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+e]=this[s+a];else Uint8Array.prototype.set.call(t,this.subarray(a,a+o),e);return o},i.prototype.fill=function(t,e,a){if("string"==typeof t){if("string"==typeof e?(e=0,a=this.length):"string"==typeof a&&(a=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<a)throw new RangeError("Out of range index");if(a<=e)return this;var s;if(e>>>=0,a=void 0===a?this.length:a>>>0,t||(t=0),"number"==typeof t)for(s=e;s<a;++s)this[s]=t;else{var o=i.isBuffer(t)?t:new i(t),n=o.length;for(s=0;s<a-e;++s)this[s+e]=o[s%n]}return this},i.concat=function(t,e){if(!r(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return n(null,0);var a;if(void 0===e)for(e=0,a=0;a<t.length;++a)e+=t[a].length;var s=l(null,e),o=0;for(a=0;a<t.length;++a){var d=t[a];if(!i.isBuffer(d))throw new TypeError('"list" argument must be an Array of Buffers');d.copy(s,o),o+=d.length}return s},i.byteLength=c,i.prototype._isBuffer=!0,i.isBuffer=function(t){return!(null==t||!t._isBuffer)},t.exports=i},ljsv:function(t,e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var a=3,r=3,s=40,i=10;function o(t,a,r){switch(t){case e.Patterns.PATTERN000:return(a+r)%2==0;case e.Patterns.PATTERN001:return a%2==0;case e.Patterns.PATTERN010:return r%3==0;case e.Patterns.PATTERN011:return(a+r)%3==0;case e.Patterns.PATTERN100:return(Math.floor(a/2)+Math.floor(r/3))%2==0;case e.Patterns.PATTERN101:return a*r%2+a*r%3==0;case e.Patterns.PATTERN110:return(a*r%2+a*r%3)%2==0;case e.Patterns.PATTERN111:return(a*r%3+(a+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(t){return null!=t&&""!==t&&!isNaN(t)&&t>=0&&t<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(t){for(var e=t.size,r=0,s=0,i=0,o=null,n=null,l=0;l<e;l++){s=i=0,o=n=null;for(var d=0;d<e;d++){var u=t.get(l,d);u===o?s++:(s>=5&&(r+=a+(s-5)),o=u,s=1),(u=t.get(d,l))===n?i++:(i>=5&&(r+=a+(i-5)),n=u,i=1)}s>=5&&(r+=a+(s-5)),i>=5&&(r+=a+(i-5))}return r},e.getPenaltyN2=function(t){for(var e=t.size,a=0,s=0;s<e-1;s++)for(var i=0;i<e-1;i++){var o=t.get(s,i)+t.get(s,i+1)+t.get(s+1,i)+t.get(s+1,i+1);4!==o&&0!==o||a++}return a*r},e.getPenaltyN3=function(t){for(var e=t.size,a=0,r=0,i=0,o=0;o<e;o++){r=i=0;for(var n=0;n<e;n++)r=r<<1&2047|t.get(o,n),n>=10&&(1488===r||93===r)&&a++,i=i<<1&2047|t.get(n,o),n>=10&&(1488===i||93===i)&&a++}return a*s},e.getPenaltyN4=function(t){for(var e=0,a=t.data.length,r=0;r<a;r++)e+=t.data[r];return Math.abs(Math.ceil(100*e/a/5)-10)*i},e.applyMask=function(t,e){for(var a=e.size,r=0;r<a;r++)for(var s=0;s<a;s++)e.isReserved(s,r)||e.xor(s,r,o(t,s,r))},e.getBestMask=function(t,a){for(var r=Object.keys(e.Patterns).length,s=0,i=1/0,o=0;o<r;o++){a(o),e.applyMask(o,t);var n=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(o,t),n<i&&(i=n,s=o)}return s}},m5o6:function(t,e){},mypn:function(t,e,a){(function(t,e){!function(t,a){"use strict";if(!t.setImmediate){var r,s,i,o,n,l=1,d={},u=!1,c=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);p=p&&p.setTimeout?p:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){f(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,a=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=a,e}}()?t.MessageChannel?((i=new MessageChannel).port1.onmessage=function(t){f(t.data)},r=function(t){i.port2.postMessage(t)}):c&&"onreadystatechange"in c.createElement("script")?(s=c.documentElement,r=function(t){var e=c.createElement("script");e.onreadystatechange=function(){f(t),e.onreadystatechange=null,s.removeChild(e),e=null},s.appendChild(e)}):r=function(t){setTimeout(f,0,t)}:(o="setImmediate$"+Math.random()+"$",n=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(o)&&f(+e.data.slice(o.length))},t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(e){t.postMessage(o+e,"*")}),p.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),a=0;a<e.length;a++)e[a]=arguments[a+1];var s={callback:t,args:e};return d[l]=s,r(l),l++},p.clearImmediate=h}function h(t){delete d[t]}function f(t){if(u)setTimeout(f,0,t);else{var e=d[t];if(e){u=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(a,r)}}(e)}finally{h(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(e,a("DuR2"),a("W2nU"))},nwDn:function(t,e){function a(t){if("string"!=typeof t)throw new Error("Color should be defined as hex string");var e=t.slice().replace("#","").split("");if(e.length<3||5===e.length||e.length>8)throw new Error("Invalid hex color: "+t);3!==e.length&&4!==e.length||(e=Array.prototype.concat.apply([],e.map(function(t){return[t,t]}))),6===e.length&&e.push("F","F");var a=parseInt(e.join(""),16);return{r:a>>24&255,g:a>>16&255,b:a>>8&255,a:255&a,hex:"#"+e.slice(0,6).join("")}}e.getOptions=function(t){t||(t={}),t.color||(t.color={});var e=void 0===t.margin||null===t.margin||t.margin<0?4:t.margin,r=t.width&&t.width>=21?t.width:void 0,s=t.scale||4;return{width:r,scale:r?4:s,margin:e,color:{dark:a(t.color.dark||"#000000ff"),light:a(t.color.light||"#ffffffff")},type:t.type,rendererOpts:t.rendererOpts||{}}},e.getScale=function(t,e){return e.width&&e.width>=t+2*e.margin?e.width/(t+2*e.margin):e.scale},e.getImageWidth=function(t,a){var r=e.getScale(t,a);return Math.floor((t+2*a.margin)*r)},e.qrToImageData=function(t,a,r){for(var s=a.modules.size,i=a.modules.data,o=e.getScale(s,r),n=Math.floor((s+2*r.margin)*o),l=r.margin*o,d=[r.color.light,r.color.dark],u=0;u<n;u++)for(var c=0;c<n;c++){var p=4*(u*n+c),h=r.color.light;if(u>=l&&c>=l&&u<n-l&&c<n-l)h=d[i[Math.floor((u-l)/o)*s+Math.floor((c-l)/o)]?1:0];t[p++]=h.r,t[p++]=h.g,t[p++]=h.b,t[p]=h.a}}},nyx9:function(t,e,a){var r=a("uF9H"),s=a("sYKs"),i=a("RO0P"),o=a("vPzN"),n=a("zYqW"),l=a("NY/E"),d=a("oLzS"),u=a("b2+w");function c(t){return unescape(encodeURIComponent(t)).length}function p(t,e,a){for(var r,s=[];null!==(r=t.exec(a));)s.push({data:r[0],index:r.index,mode:e,length:r[0].length});return s}function h(t){var e,a,s=p(l.NUMERIC,r.NUMERIC,t),i=p(l.ALPHANUMERIC,r.ALPHANUMERIC,t);return d.isKanjiModeEnabled()?(e=p(l.BYTE,r.BYTE,t),a=p(l.KANJI,r.KANJI,t)):(e=p(l.BYTE_KANJI,r.BYTE,t),a=[]),s.concat(i,e,a).sort(function(t,e){return t.index-e.index}).map(function(t){return{data:t.data,mode:t.mode,length:t.length}})}function f(t,e){switch(e){case r.NUMERIC:return s.getBitsLength(t);case r.ALPHANUMERIC:return i.getBitsLength(t);case r.KANJI:return n.getBitsLength(t);case r.BYTE:return o.getBitsLength(t)}}function m(t,e){var a,l=r.getBestModeForData(t);if((a=r.from(e,l))!==r.BYTE&&a.bit<l.bit)throw new Error('"'+t+'" cannot be encoded with mode '+r.toString(a)+".\n Suggested mode is: "+r.toString(l));switch(a!==r.KANJI||d.isKanjiModeEnabled()||(a=r.BYTE),a){case r.NUMERIC:return new s(t);case r.ALPHANUMERIC:return new i(t);case r.KANJI:return new n(t);case r.BYTE:return new o(t)}}e.fromArray=function(t){return t.reduce(function(t,e){return"string"==typeof e?t.push(m(e,null)):e.data&&t.push(m(e.data,e.mode)),t},[])},e.fromString=function(t,a){for(var s=function(t,e){for(var a={},s={start:{}},i=["start"],o=0;o<t.length;o++){for(var n=t[o],l=[],d=0;d<n.length;d++){var u=n[d],c=""+o+d;l.push(c),a[c]={node:u,lastCount:0},s[c]={};for(var p=0;p<i.length;p++){var h=i[p];a[h]&&a[h].node.mode===u.mode?(s[h][c]=f(a[h].lastCount+u.length,u.mode)-f(a[h].lastCount,u.mode),a[h].lastCount+=u.length):(a[h]&&(a[h].lastCount=u.length),s[h][c]=f(u.length,u.mode)+4+r.getCharCountIndicator(u.mode,e))}}i=l}for(p=0;p<i.length;p++)s[i[p]].end=0;return{map:s,table:a}}(function(t){for(var e=[],a=0;a<t.length;a++){var s=t[a];switch(s.mode){case r.NUMERIC:e.push([s,{data:s.data,mode:r.ALPHANUMERIC,length:s.length},{data:s.data,mode:r.BYTE,length:s.length}]);break;case r.ALPHANUMERIC:e.push([s,{data:s.data,mode:r.BYTE,length:s.length}]);break;case r.KANJI:e.push([s,{data:s.data,mode:r.BYTE,length:c(s.data)}]);break;case r.BYTE:e.push([{data:s.data,mode:r.BYTE,length:c(s.data)}])}}return e}(h(t,d.isKanjiModeEnabled())),a),i=u.find_path(s.map,"start","end"),o=[],n=1;n<i.length-1;n++)o.push(s.table[i[n]].node);return e.fromArray(function(t){return t.reduce(function(t,e){var a=t.length-1>=0?t[t.length-1]:null;return a&&a.mode===e.mode?(t[t.length-1].data+=e.data,t):(t.push(e),t)},[])}(o))},e.rawSplit=function(t){return e.fromArray(h(t,d.isKanjiModeEnabled()))}},oLzS:function(t,e){var a,r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];e.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return 4*t+17},e.getSymbolTotalCodewords=function(t){return r[t]},e.getBCHDigit=function(t){for(var e=0;0!==t;)e++,t>>>=1;return e},e.setToSJISFunction=function(t){if("function"!=typeof t)throw new Error('"toSJISFunc" is not a valid function.');a=t},e.isKanjiModeEnabled=function(){return void 0!==a},e.toSJIS=function(t){return a(t)}},onfh:function(t,e){},rRYa:function(t,e){},sJr7:function(t,e){},sYKs:function(t,e,a){var r=a("uF9H");function s(t){this.mode=r.NUMERIC,this.data=t.toString()}s.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(t){var e,a,r;for(e=0;e+3<=this.data.length;e+=3)a=this.data.substr(e,3),r=parseInt(a,10),t.put(r,10);var s=this.data.length-e;s>0&&(a=this.data.substr(e),r=parseInt(a,10),t.put(r,3*s+1))},t.exports=s},thGH:function(t,e,a){"use strict";const r=a("7OuW"),s=a("BAz6");var i={props:["jiraKey"],components:{},data:()=>({info:null,status:""}),async mounted(){await this.init()},watch:{"$store.state.applyNotice":function(){s.datacenter.manualTest.deleteManualTest(this.jiraKey).then(t=>{1==t.data.lastErrorObject.n&&(this.info=null)}).catch(t=>{})}},methods:{link(t,e){this.$router.push({name:t,query:{jiraKey:e}})},init(){s.datacenter.manualTest.findManualTest(this.jiraKey).then(t=>{t.data.ret&&(this.info=t.data.ret.username+"--"+t.data.ret.updateTimestamp,this.status=t.data.ret.status)}).catch(t=>{console.log(t)})},failManual(){s.datacenter.manualTest.findAndUpdateManualTest(this.jiraKey,this.$store.state.user.displayName,"不通过").then(t=>{t.data.state?r(20).then(t=>{this.$notify.success({title:"",message:"执行成功",showClose:1e3}),this.init(),this.$store.commit("changeExpressManual",t)}):this.$notify({title:"",message:"执行失败",showClose:1e3})}).catch(t=>{console.log(t)})},successManual(){s.datacenter.manualTest.findAndUpdateManualTest(this.jiraKey,this.$store.state.user.displayName,"通过").then(t=>{t.data.state?r(20).then(t=>{this.init(),this.$notify.success({title:"",message:"执行成功",showClose:1e3}),this.$store.commit("changeExpressManual",t)}):this.$notify({title:"",message:"执行失败",showClose:1e3})}).catch(t=>{console.log(t)})}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("h3",{staticClass:"title"},[t._v("人工测试")]),t.info?a("p",["不通过"===t.status?a("el-tag",{attrs:{type:"danger"}},[t._v("不通过")]):t._e(),"通过"===t.status?a("el-tag",{attrs:{type:"primary"}},[t._v("通过")]):t._e(),"未确认"===t.status?a("el-tag",{attrs:{type:"info"}},[t._v("未确认")]):t._e(),a("span",{staticClass:"infoMessage"},[t._v(t._s(t.info))])],1):a("p",[a("el-tag",{attrs:{type:"info"}},[t._v("未确认")])],1)]),a("el-row",[a("el-button",{staticClass:"smallBtn",attrs:{type:"danger"},on:{click:t.failManual}},[t._v("不通过")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.successManual}},[t._v("通过")])],1)],1)},staticRenderFns:[]};var n=a("VU/8")(i,o,!1,function(t){a("m5o6")},"data-v-0482c7d4",null);e.a=n.exports},uF9H:function(t,e,a){var r=a("yYhy"),s=a("NY/E");e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(t,e){if(!t.ccBits)throw new Error("Invalid mode: "+t);if(!r.isValid(e))throw new Error("Invalid version: "+e);return e>=1&&e<10?t.ccBits[0]:e<27?t.ccBits[1]:t.ccBits[2]},e.getBestModeForData=function(t){return s.testNumeric(t)?e.NUMERIC:s.testAlphanumeric(t)?e.ALPHANUMERIC:s.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(t){if(t&&t.id)return t.id;throw new Error("Invalid mode")},e.isValid=function(t){return t&&t.bit&&t.ccBits},e.from=function(t,a){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch(t){return a}}},utyv:function(t,e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2},e.isValid=function(t){return t&&void 0!==t.bit&&t.bit>=0&&t.bit<4},e.from=function(t,a){if(e.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+t)}}(t)}catch(t){return a}}},vPzN:function(t,e,a){var r=a("jF+B"),s=a("uF9H");function i(t){this.mode=s.BYTE,this.data=new r(t)}i.getBitsLength=function(t){return 8*t},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(t){for(var e=0,a=this.data.length;e<a;e++)t.put(this.data[e],8)},t.exports=i},vxKL:function(t,e){},wBZN:function(t,e,a){var r=a("jF+B"),s=a("X0RI");function i(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}i.prototype.initialize=function(t){this.degree=t,this.genPoly=s.generateECPolynomial(this.degree)},i.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");var e=new r(this.degree);e.fill(0);var a=r.concat([t,e],t.length+this.degree),i=s.mod(a,this.genPoly),o=this.degree-i.length;if(o>0){var n=new r(this.degree);return n.fill(0),i.copy(n,o),n}return i},t.exports=i},wopq:function(t,e){},"xR/K":function(t,e,a){var r=a("oLzS"),s=r.getBCHDigit(1335);e.getEncodedBits=function(t,e){for(var a=t.bit<<3|e,i=a<<10;r.getBCHDigit(i)-s>=0;)i^=1335<<r.getBCHDigit(i)-s;return 21522^(a<<10|i)}},yYhy:function(t,e){e.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40}},zXcN:function(t,e,a){"use strict";var r=a("NZZJ"),s=a("uMhb");const i=a("T5Ki"),o=(a("ADll"),a("BAz6")),n=a("7OuW"),l=[{infoText:"*构建产物下载地址",inputInfo:"",placeholder:"移动端，提供构建产物下载地址（地址若临时存在问题，可邮件附件附上构建产物，并及时修复构建产物下载问题）",textarea:!0},{infoText:"备注",inputInfo:"",placeholder:"其他补充说明",textarea:!0}],d=[{infoText:"*产品经理",inputInfo:""},{infoText:"*前端开发",inputInfo:""},{infoText:"*后端开发",inputInfo:""},{infoText:"*客户端开发",inputInfo:""},{infoText:"*测试负责人",inputInfo:""},{infoText:"*测试人员",inputInfo:""}],u=[{infoText:"*提测功能描述",inputInfo:"",placeholder:"描述提测的功能细节，涉及到的页面以及测试进入的主要操作步奏"},{infoText:"测试建议/bug修复说明",inputInfo:"",placeholder:"需明确说明细节，并给出问题修改及影响面，测试需覆盖的范围、注意点等"},{infoText:"*环境说明",inputInfo:"",placeholder:"前端自测使用XXX，同服务端联调使用XXX"},{infoText:"*git仓库地址",inputInfo:"",placeholder:"git仓库地址"},{infoText:"*编译分支",inputInfo:"",options:[],selectBranch:"",placeholder:"编译分支"},{infoText:"*版本号",inputInfo:"",placeholder:"版本号"},{infoText:"*Code Review人员",inputInfo:"",placeholder:"XXX（前端）；XXX（后端）"},{infoText:"*准入Case执行情况",inputInfo:"",placeholder:"全部自测通过或部分自测通过"}],c=[{infoText:"*私有库",ku:"无",num:"无",duan:"无",result:"无"},{infoText:"*与其他端共享库",ku:"无",num:"无",duan:"无",result:"无"},{infoText:"*第三方依赖库",ku:"无",num:"无",duan:"无",result:"无"}],p=[{infoText:"*前端和后端联调",inputInfo:"",placeholder:"涉及，在XX环境准入Case全部通过"},{infoText:"移动端和服务端联调",inputInfo:"",placeholder:"涉及或不涉及"},{infoText:"跨业务端联调",inputInfo:"",placeholder:"涉及或不涉及"},{infoText:"同第三方联调",inputInfo:"",placeholder:"涉及或不涉及"}];var h={props:["jiraKey","report"],components:{l_getEmail:r.a,l_uploadFile:s.a},data(){return{data:{jiraStep:null,jiraKey:this.jiraKey,type:"mobileTestApply",sendUserMail:"",sendUserName:"",emailTo:[],summary:"",env:null,subTasks:[],projecUserInfo:d,testInfo:u,relationGitInfo:c,unionTest:p,otherInfo:l,bugList:[],uploadFiles:[],subTaskradio:""},testApplyTime:"",issuetype:"",showUploadlist:[],project:{},selectBranch:"",rules:{selectBranch:[{type:"string",required:!0,message:"请选择一个分支",trigger:"blur"}],emailTo:[{type:"array",required:!0,message:"请输入收件人",trigger:"blur"}],inputInfo:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],libs:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],type:[{required:!0,message:"请至少选择一个子任务",trigger:"blur"}],ku:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],num:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],duan:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],result:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}]}}},computed:{isNeedGitInfo(){var t=!1;return"AC"!=this.jiraKey.split("-")[0]&&"WFTEST"!=this.jiraKey.split("-")[0]||(this.data.testInfo[3].inputInfo="/mobile-app/app-study-center",this.getListBranches(this.data.testInfo[3].inputInfo),t=!0),t}},watch:{selectBranch:{handler:async function(){this.data.testInfo[4].selectBranch=this.selectBranch,this.data.testInfo[4].inputInfo=this.selectBranch,this.data.relationGitInfo=[],await this.getPodfileDiff(this.data.testInfo[3].inputInfo,this.selectBranch)},deep:!0},report:{handler:async function(){""!=this.report?(this.data.summary=this.report.summary,o.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t}),this.data.projecUserInfo=this.report.projecUserInfo,this.data.testInfo=this.report.testInfo,this.data.testInfo[4].selectBranch="",this.data.unionTest=this.report.unionTest,this.data.otherInfo=this.report.otherInfo):""==this.report&&(o.jira.getSummary(this.jiraKey).then(t=>{this.data.summary=this.jiraKey+":"+t.fields.summary}),o.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t}),this.data.projecUserInfo=d,this.data.testInfo=u,this.data.relationGitInfo=c,this.data.unionTest=p,this.data.otherInfo=l),await this.getSubTask(),await this.getProjectPersonInfo(),await this.getProjectBugList()},deep:!0}},async mounted(){this.data.sendUserMail=this.$store.state.user.mail,this.data.sendUserName=this.$store.state.user.displayName,""!==this.report?(this.data.jiraKey=this.report.jiraKey,this.data.summary=this.report.summary,o.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t}),this.data.projecUserInfo=this.report.projecUserInfo,this.data.testInfo=this.report.testInfo,this.data.testInfo[4].selectBranch="",this.data.unionTest=this.report.unionTest,this.data.otherInfo=this.report.otherInfo):""==this.report&&(this.data.jiraKey=this.jiraKey,o.jira.getSummary(this.jiraKey).then(t=>{this.data.summary=this.jiraKey+":"+t.fields.summary}),o.jira.initEmailList(this.jiraKey).then(t=>{this.data.emailTo=t}),this.data.projecUserInfo=d,this.data.testInfo=u,this.data.relationGitInfo=c,this.data.unionTest=p,this.data.otherInfo=l),await this.getSubTask(),await this.getProjectPersonInfo(),await this.getProjectBugList()},methods:{getPodfileDiff(t,e){this.$API.getPodfileDiff({endpointParams:{gitPath:t,branch:e}}).then(t=>{t.data.diffdata.pod.length&&t.data.diffdata.pod.forEach(t=>{let e={infoText:"",ku:"",num:"",duan:"无",result:"无"};e.infoText=t.type+":"+("ADD"==t.changeType?"新增":"CHANGE"==t.changeType?"更新":"删除"),e.ku=t.name,(t.version.old||t.version.current)&&(e.num="version:\n旧:"+t.version.old+"\n新:"+t.version.current+"\n"),(t.source.old||t.source.current)&&(e.num+="source:\n旧:"+t.source.old+"\n新:"+t.source.current+"\n"),(t.gitUrl.old||t.gitUrl.current)&&(e.num+="gitUrl:\n旧:"+t.gitUrl.old+"\n新:"+t.gitUrl.current+"\n"),(t.commitId.old||t.commitId.current)&&(e.num+="commitId:\n旧:"+t.commitId.old+"\n新:"+t.commitId.current+"\n"),(t.tag.old||t.tag.current)&&(e.num+="tag:\n旧:"+t.tag.old+"\n新:"+t.tag.current+"\n"),this.data.relationGitInfo.push(e)}),t.data.diffdata.source.length&&t.data.diffdata.source.forEach(t=>{let e={infoText:"",ku:"",num:"",duan:"无",result:"无"};e.infoText="source",(t.tag.old||t.tag.current)&&(e.num+="tag:\n旧:"+t.tag.old+"\n新:"+t.tag.current+"\n"),this.data.relationGitInfo.push(e)})}).catch(function(t){console.log(t)})},getListBranches(t){this.$API.listBranchs({endpointParams:{path:t}}).then(t=>{this.data.testInfo[4].options=[],this.data.testInfo[4].selectBranch="",t.data.ret.forEach(t=>{var e={label:"",value:""};e.label=t.name,e.value=t.name,this.data.testInfo[4].options.push(e)})}).catch(function(t){console.log(t)})},preventStop(t){t.preventDefault()},arraySpanMethod({row:t,column:e,rowIndex:a,columnIndex:r}){if(0==r){if(t.libs.length>1)return[t.libs.length,1]}else if(0!==r)return[0,0]},addItem(t,e){let a=JSON.stringify(e);this.data.relationGitInfo.splice(t+1,0,JSON.parse(a))},deleteItem(t,e){this.data.relationGitInfo=this.data.relationGitInfo.filter(function(e,a){return t!=a})},getSubTask(){this.data.subTasks=[],o.jira.getSubTask(this.jiraKey).then(t=>{t.map(t=>{this.data.subTasks.push({jiraID:t.key,summary:t.fields.summary,status:t.fields.status.name})})})},getProjectPersonInfo(){o.jira.getProjectPersonInfo(this.jiraKey).then(t=>{this.data.projecUserInfo[0].inputInfo=t.productor,this.data.projecUserInfo[1].inputInfo=t.qrd?t.qrd.join(","):t.qrd,this.data.projecUserInfo[2].inputInfo=t.hrd?t.hrd.join(","):t.hrd,this.data.projecUserInfo[4].inputInfo=t.testManager,this.data.projecUserInfo[5].inputInfo=t.qa?t.qa.join(","):t.qa})},getTableHeaderCellStyle:()=>({background:"#f85415",color:"#FFFFFF"}),getProjectBugList(){var t=this;t.data.bugList=[],o.jira.getProjectBugList(this.jiraKey,"待验证").then(e=>{e.map(function(e){t.data.bugList.push({jiraID:e.key,summary:e.fields.summary,priority:e.fields.priority.name,severity:e.fields.customfield_10241.value,rd:e.fields.customfield_10639.displayName,qa:e.fields.customfield_10640.displayName,status:"待验证",submit:!0})})})},cancle(){this.$emit("closeDialog")},getJiraInfo:async function(){return new Promise((t,e)=>{axios.get("/api-jiraproxy/api/findIssue?key="+this.jiraKey+"&fields=summary,status,issuetype,customfield_10710").then(e=>{this.jiraStep=e.data.ret.fields.status.name,this.issuetype=e.data.ret.fields.issuetype.name,this.testApplyTime=e.data.ret.fields.customfield_10710,t(this.jiraStep)}).catch(function(t){e(t)})})},emailCreateContent(){return i.clientTitleToHtml(this.data)+i.jiraToHtml(this.data)+i.subTasksToHtml(this.data)+i.clientTestApply_projecUserInfo(this.data)+i.clientTestInfo(this.data)+i.clientRelationGitInfo(this.data)+i.clientUnionTestInfo(this.data)+i.clientOtherInfo(this.data)+i.bugListToHtml(this.data)+i.fileListToHtml(this.data)},send(){var t=this,e=!0;if(Object.keys(this.$refs).forEach(function(a){t.$refs[a]&&t.$refs[a].validate(t=>{t||(e=!1)})}),e){t=this;var a=0;this.data.subTasks.forEach(function(t){t.submit&&(a+=1)}),this.data.subTasks.length==a&&(this.data.isSubmitAll=!0);var r=[];this.data.emailTo.forEach(function(t){r.push(t+"@vipkid.com.cn")}),r.push(this.$store.state.user.mail);var s="【客户端测试申请】"+this.data.summary+"--项目测试申请  发送人:"+this.$store.state.user.displayName,i=this.emailCreateContent(),l={receiver:r.join(",")+",zhangpengyang@vipkid.com.cn,xielin1@vipkid.com.cn,mengdeliang@vipkid.com.cn,zhuxingjun@vipkid.com.cn,changlili@vipkid.com.cn",title:s,content:i};o.report.insertOne(this.data).then(e=>{if(e.data.state){o.mailsender.send(l).then(e=>{e.data.state&&(n(20).then(e=>{t.$store.commit("changeApplyNotice",e)}),t.$notify.success({title:"提示",message:"发送测试申请成功",duration:2e3}))});var a={sendTime:e.data.sendTime,sendUser:this.$store.state.user.username,sendUserName:this.$store.state.user.displayName,isAll:this.data.isSubmitAll,subTasks:this.data.subTasks};o.datacenter.testApply.findAndUpdateTestApply(t.jiraKey,a,"已提测").then(t=>{if(t.data.state){var e=this.$store.state.user.displayName+" 发送了测试申请";o.jira.addComment(this.jiraKey,e),o.datacenter.step.findAndUpdateStep(this.jiraKey,"提测"),this.$emit("update"),this.applyTestJira()}}),this.$emit("closeDialog")}})}else console.log("valid error")},uploadFiles:function(t){var e=[];for(var a in t){var r={};r.name=t[a].name,r.url="http://10.16.16.3/"+this.jiraKey+"/report/"+t[a].name,e.push(r)}this.data.uploadFiles=e},getEmailList(t){if(this.data.emailTo=t,this.data.emailTo.length>0)for(var e in this.$refs.form0.fields)"收件人"==this.$refs.form0.fields[e].label&&(this.$refs.form0.fields[e].resetField(),this.data.emailTo=t)},preventStop(t){t.preventDefault()},async applyTestJira(){await this.getJiraInfo(),o.timestamp.updateTime(this.jiraKey,"testApply");var t=o.jira.transitions.getTransitionType(this.jiraKey.split("-")[0],this.issuetype);if("Template for Project v11"==t){var e=(s=new o.jira.transitions_v11).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{var r={fields:{customfield_10710:moment().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Tech-Project v4.0"==t){e=(s=new o.jira.transitions_tech_v1).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{r={fields:{customfield_10710:moment().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Buiness Requirement Project v12"==t||"Template for Buiness Requirement Project v12.1"==t){e=(s=new o.jira.transitions_yw_v12).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{r={fields:{customfield_10710:moment().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}else if("Template for Product Requirement Project v12"==t||"Template for Product Requirement Project v12.1"==t){var s;e=(s=new o.jira.transitions_cp_v12).judge(this.jiraStep,"testApply");for(var a in e)await s.updateStatus(this.jiraKey,e[a].id);if(this.testApplyTime);else{r={fields:{customfield_10710:moment().format("YYYY-MM-DDTHH:mm:ss")+".000+0800"}};axios.post("/api-jiraproxy/api/updateIssue?key="+this.jiraKey,r).then(t=>{}).catch(t=>{console.log(t)})}}}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form0",staticClass:"demo-ruleForm",attrs:{model:t.data,rules:t.rules,"label-width":"100px","label-position":"right"},nativeOn:{submit:function(e){return t.preventStop(e)}}},[a("el-form-item",{attrs:{label:"收件人",prop:"emailTo"}},[a("l_getEmail",{attrs:{emailTo:t.data.emailTo,getEmailList:t.getEmailList}})],1),a("el-form-item",{attrs:{label:"项目名称"}},[a("a",{attrs:{href:"http://jira.vipkid.com.cn/browse/"+t.data.jiraKey,target:"view_window"}},[t._v(t._s(t.data.summary))])])],1),a("el-table",{attrs:{data:t.data.subTasks,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"本次提测子任务(至少选一个)"}},[a("el-table-column",{attrs:{label:"提测"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}})],1)],1),a("el-table",{attrs:{data:t.data.projecUserInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"提测信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form1"+e.$index,staticClass:"demo-ruleForm",attrs:{model:t.data.projecUserInfo[e.$index],rules:t.rules}},[a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.infoText},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)],1)]}}])})],1),a("el-table",{attrs:{data:t.data.testInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"项目信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[t.isNeedGitInfo?t._e():a("el-form",{ref:"form2"+e.$index,staticClass:"demo-ruleForm",attrs:{model:t.data.testInfo[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1),t.isNeedGitInfo?a("el-form",{ref:"form2"+e.$index,staticClass:"demo-ruleForm",attrs:{model:t.data.testInfo[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")&&4!==e.$index?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):t._e(),-1!==e.row.infoText.indexOf("*")&&4==e.$index?a("el-form-item",{attrs:{prop:"selectBranch"}},[a("el-select",{model:{value:t.selectBranch,callback:function(e){t.selectBranch=e},expression:"selectBranch"}},t._l(e.row.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1):t._e(),-1==e.row.infoText.indexOf("*")?a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}}):t._e()],1):t._e()]}}])})],1),a("el-table",{attrs:{data:t.data.relationGitInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"依赖库变更说明(当前编译分支和master最新版本podfile比较)"}},[a("el-table-column",{attrs:{label:"分类"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{attrs:{label:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form3"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"ku"}},[a("el-input",{attrs:{type:"text"},model:{value:e.row.ku,callback:function(a){t.$set(e.row,"ku",a)},expression:"scope.row.ku"}})],1)],1)]}}])}),a("el-table-column",{attrs:{label:"变更信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form4"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"num"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.row.num,callback:function(a){t.$set(e.row,"num",a)},expression:"scope.row.num"}})],1)],1)]}}])}),a("el-table-column",{attrs:{label:"影响端"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form5"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"duan"}},[a("el-input",{attrs:{type:"text"},model:{value:e.row.duan,callback:function(a){t.$set(e.row,"duan",a)},expression:"scope.row.duan"}})],1)],1)]}}])}),a("el-table-column",{attrs:{label:"影响业务/功能"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form6"+e.$index,staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"result"}},[a("el-input",{attrs:{type:"text"},model:{value:e.row.result,callback:function(a){t.$set(e.row,"result",a)},expression:"scope.row.result"}})],1)],1)]}}])}),t.isNeedGitInfo?t._e():a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-row",[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"circle"},on:{click:function(a){t.deleteItem(e.$index,e.row)}}}),a("el-button",{attrs:{type:"sucess",icon:"el-icon-plus",circle:"circle"},on:{click:function(a){t.addItem(e.$index,e.row)}}})],1)]}}])})],1)],1),a("el-table",{attrs:{data:t.data.unionTest,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"联调情况"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form7"+e.$index,staticClass:"demo-ruleForm",attrs:{model:t.data.unionTest[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)]}}])})],1),a("el-table",{attrs:{data:t.data.otherInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"其他情况"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{ref:"form8"+e.$index,staticClass:"demo-ruleForm",attrs:{model:t.data.unionTest[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):a("el-input",{attrs:{type:"textarea",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)]}}])})],1),t.data.bugList.length?a("el-table",{attrs:{data:t.data.bugList,"max-height":"300",border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"提测待验证BUG"}},[a("el-table-column",{attrs:{label:"本次提测",fixed:"fixed"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID",width:"100px;"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),a("el-table-column",{attrs:{prop:"severity",label:"严重程度"}}),a("el-table-column",{attrs:{prop:"qa",label:"提测人"}}),a("el-table-column",{attrs:{prop:"rd",label:"修复人"}})],1)],1):t._e(),a("el-form",{staticClass:"demo-ruleForm"},[a("el-form-item",{attrs:{label:"上传附件"}},[a("l_uploadFile",{attrs:{jiraKey:t.jiraKey,fileType:"report",showUploadlistInfo:t.showUploadlist,oninput:t.uploadFiles}})],1)],1),a("el-button",{attrs:{size:"small",type:"primary",center:"center"},on:{click:t.send}},[t._v("发送提测申请")]),a("el-button",{attrs:{size:"small",center:"center"},on:{click:t.cancle}},[t._v("取消发送")])],1)},staticRenderFns:[]};var m=a("VU/8")(h,f,!1,function(t){a("izB8")},"data-v-23eb71be",null).exports,g={props:["jiraKey","report"],data(){return{data:{jiraStep:null,jiraKey:this.jiraKey,type:"mobileTestApply",sendUserMail:"",sendUserName:"",emailTo:[],summary:"",env:null,subTasks:[],projecUserInfo:[],testInfo:[],relationGitInfo:[],unionTest:[],otherInfo:[],bugList:[],uploadFiles:[],subTaskradio:""},showUploadlist:[],project:{},rules:{emailTo:[{type:"array",required:!0,message:"请输入收件人",trigger:"blur"}],inputInfo:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],libs:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],type:[{required:!0,message:"请至少选择一个子任务",trigger:"blur"}],ku:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],num:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],duan:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}],result:[{type:"string",required:!0,message:"必填项不能为空",trigger:"blur"}]}}},watch:{report:{handler:async function(){this.data=this.report},deep:!0}},mounted(){this.data=this.report},methods:{getTableHeaderCellStyle:()=>({background:"#f85415",color:"#FFFFFF"}),cancle(){this.$emit("closeDialog")}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:t.data,rules:t.rules,"label-width":"100px","label-position":"right"}},[a("el-form-item",{attrs:{label:"收件人",prop:"emailTo"}},[a("el-input",{attrs:{placeholder:t.data.emailTo,disabled:!0}})],1),a("el-form-item",{attrs:{label:"项目名称"}},[a("a",{attrs:{href:"http://jira.vipkid.com.cn/browse/"+t.data.jiraKey,target:"view_window"}},[t._v(t._s(t.data.summary))])])],1),a("el-table",{attrs:{data:t.data.subTasks,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"本次提测子任务(至少选一个)"}},[a("el-table-column",{attrs:{label:"提测"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:!0,checked:t.row.submit}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"status",label:"状态"}})],1)],1),a("el-table",{attrs:{data:t.data.projecUserInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("div",[t._v(t._s(t.data.projecUserInfo))]),a("el-table-column",{attrs:{label:"提测信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{disabled:!0,type:"text",placeholder:e.row.infoText},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)],1)]}}])})],1),a("el-table",{attrs:{data:t.data.testInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"项目信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:t.data.testInfo[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{disabled:!0,type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):a("el-input",{attrs:{disabled:!0,type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)]}}])})],1),a("el-table",{attrs:{data:t.data.relationGitInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"依赖库变更说明"}},[a("el-table-column",{attrs:{label:"分类"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{attrs:{label:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"ku"}},[a("el-input",{attrs:{disabled:!0,type:"text"},model:{value:e.row.ku,callback:function(a){t.$set(e.row,"ku",a)},expression:"scope.row.ku"}})],1)],1)]}}])}),a("el-table-column",{attrs:{label:"变更信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"num"}},[a("el-input",{attrs:{disabled:!0,type:"text"},model:{value:e.row.num,callback:function(a){t.$set(e.row,"num",a)},expression:"scope.row.num"}})],1)],1)]}}])}),a("el-table-column",{attrs:{label:"影响端"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"duan"}},[a("el-input",{attrs:{disabled:!0,type:"text"},model:{value:e.row.duan,callback:function(a){t.$set(e.row,"duan",a)},expression:"scope.row.duan"}})],1)],1)]}}])}),a("el-table-column",{attrs:{label:"影响业务/功能"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:e.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:"result"}},[a("el-input",{attrs:{disabled:!0,type:"text"},model:{value:e.row.result,callback:function(a){t.$set(e.row,"result",a)},expression:"scope.row.result"}})],1)],1)]}}])})],1)],1),a("el-table",{attrs:{data:t.data.unionTest,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"联调情况"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:t.data.unionTest[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{disabled:!0,type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):a("el-input",{attrs:{disabled:!0,type:"text",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)]}}])})],1),a("el-table",{attrs:{data:t.data.otherInfo,border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"其他情况"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.infoText))])]}}])}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-ruleForm",attrs:{model:t.data.unionTest[e.$index],rules:t.rules}},[-1!==e.row.infoText.indexOf("*")?a("el-form-item",{attrs:{prop:"inputInfo"}},[a("el-input",{attrs:{disabled:!0,type:"textarea",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1):a("el-input",{attrs:{disabled:!0,type:"textarea",placeholder:"请输入"+e.row.placeholder},model:{value:e.row.inputInfo,callback:function(a){t.$set(e.row,"inputInfo",a)},expression:"scope.row.inputInfo"}})],1)]}}])})],1),t.data.bugList.length?a("el-table",{attrs:{data:t.data.bugList,"max-height":"300",border:"border","header-cell-style":t.getTableHeaderCellStyle}},[a("el-table-column",{attrs:{label:"提测待验证BUG"}},[a("el-table-column",{attrs:{label:"本次提测",fixed:"fixed"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-checkbox",{attrs:{disabled:!0,checked:e.row.submit},model:{value:e.row.submit,callback:function(a){t.$set(e.row,"submit",a)},expression:"scope.row.submit"}})]}}])}),a("el-table-column",{attrs:{prop:"jiraID",label:"jiraID",width:"100px;"}}),a("el-table-column",{attrs:{prop:"summary",label:"摘要"}}),a("el-table-column",{attrs:{prop:"priority",label:"优先级"}}),a("el-table-column",{attrs:{prop:"severity",label:"严重程度"}}),a("el-table-column",{attrs:{prop:"qa",label:"提测人"}}),a("el-table-column",{attrs:{prop:"rd",label:"修复人"}})],1)],1):t._e(),a("div",t._l(t.data.uploadFiles,function(e,r){return a("p",{key:r},[a("a",{attrs:{href:e.url,target:"view_window"}},[t._v(t._s(e.name))])])})),a("el-row",{attrs:{align:"center"}},[a("p",[a("el-button",{attrs:{type:"primary",size:"small",center:"center"},on:{click:t.cancle}},[t._v("关闭")])],1)])],1)},staticRenderFns:[]};var y=a("VU/8")(g,b,!1,function(t){a("GNMf")},"data-v-acdc21d6",null).exports;const v=a("BAz6");var w={props:["jiraKey"],components:{sendForm:m,showForm:y},data:()=>({type:"mobileTestApply",sendFormVisible:!1,showFormVisible:!1,isAreadySend:!0,tableData:[],report:[],showReport:[],lastApplyInfo:{info:"",status:""}}),watch:{"$store.state.applyUpdate":async function(){await this.update()}},async mounted(){this.tableData=[],await this.initHistoryApply(),await this.getLastApplyInfo()},methods:{getLastApplyInfo(){v.datacenter.testApply.findTestApply(this.jiraKey).then(t=>{if(t.data.ret){var e;e=t.data.ret.info.sendUserName+"--"+t.data.ret.info.sendTime,this.lastApplyInfo.info=e,this.lastApplyInfo.status=t.data.ret.status}else this.isAreadySend=!1})},submit(){this.report="",this.sendFormVisible=!0},link(t,e){this.$router.push({name:t,query:{jiraKey:e}})},initHistoryApply(){v.report.getReport(this.jiraKey,this.type).then(t=>{t.data.ret?this.tableData=t.data.ret:this.isAreadySend=!1})},redo(t,e){this.report=t,this.sendFormVisible=!0},review(t){this.showReport=t,this.showFormVisible=!0},async update(){this.isAreadySend=!0,this.tableData=[],await this.initHistoryApply(),await this.getLastApplyInfo()}}},T={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.isAreadySend?a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("h3",[t._v("项目提测申请")]),t.lastApplyInfo.info?a("p",[a("label",[t._v("最新提测：")]),"不通过"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"danger"}},[t._v("不通过")]):t._e(),"通过"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"success"}},[t._v("通过")]):t._e(),"已提测"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"info"}},[t._v("已提测")]):t._e(),"打回"==t.lastApplyInfo.status?a("el-tag",{attrs:{type:"danger"}},[t._v("打回")]):t._e(),t._v(" "+t._s(t.lastApplyInfo.info))],1):t._e(),a("el-row",[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(e){t.link("myBugs",t.jiraKey)}}},[t._v("进入“我的BUG”")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("发送提测申请")])],1)],1),a("p",[a("el-row",[t.tableData.length?a("el-table",{attrs:{border:"border",data:t.tableData}},[a("el-table-column",{attrs:{label:"操作",fixed:"fixed"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(a){t.redo(e.row,e.row.index)}}},[t._v("复用")])]}}])}),a("el-table-column",{attrs:{label:"查看"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(a){t.review(e.row,e.row.index)}}},[t._v("查看")])]}}])}),a("el-table-column",{attrs:{prop:"sendTime",label:"提测时间"}}),a("el-table-column",{attrs:{prop:"sendUserName",label:"提测人"}})],1):t._e()],1)],1)],1):t._e(),t.isAreadySend?t._e():a("el-card",{attrs:{shadow:"hover"}},[a("h3",[t._v("提交测试申请")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:function(e){t.link("myBugs",t.jiraKey)}}},[t._v("进入“我的BUG”")]),a("el-button",{staticClass:"smallBtn",attrs:{type:"primary"},on:{click:t.submit}},[t._v("发送提测申请")])],1),a("el-dialog",{attrs:{title:"发送提测申请",visible:t.sendFormVisible,center:"center",width:"900px"},on:{"update:visible":function(e){t.sendFormVisible=e}}},[a("sendForm",{attrs:{jiraKey:t.jiraKey,report:t.report},on:{update:t.update,closeDialog:function(e){t.sendFormVisible=!1}}})],1),a("el-dialog",{attrs:{title:"历史提测申请",visible:t.showFormVisible,center:"center",width:"900px"},on:{"update:visible":function(e){t.showFormVisible=e}}},[a("showForm",{attrs:{jiraKey:t.jiraKey,report:t.showReport},on:{closeDialog:function(e){t.showFormVisible=!1}}})],1)],1)},staticRenderFns:[]};var _=a("VU/8")(w,T,!1,function(t){a("KJD0")},"data-v-4c8e6c0c",null);e.a=_.exports},zYqW:function(t,e,a){var r=a("uF9H"),s=a("oLzS");function i(t){this.mode=r.KANJI,this.data=t}i.getBitsLength=function(t){return 13*t},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(t){var e;for(e=0;e<this.data.length;e++){var a=s.toSJIS(this.data[e]);if(a>=33088&&a<=40956)a-=33088;else{if(!(a>=57408&&a<=60351))throw new Error("Invalid SJIS character: "+this.data[e]+"\nMake sure your charset is UTF-8");a-=49472}a=192*(a>>>8&255)+(255&a),t.put(a,13)}},t.exports=i}});
//# sourceMappingURL=3.a69ae0b7206a94b823e3.js.map